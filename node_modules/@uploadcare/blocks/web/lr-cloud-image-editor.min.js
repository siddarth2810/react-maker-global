/**
 * @license
 * MIT License
 * 
 * Copyright (c) 2022 Uploadcare (hello@uploadcare.com). All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
var qt=Object.defineProperty;var Yt=(r,i,e)=>i in r?qt(r,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[i]=e;var p=(r,i,e)=>(Yt(r,typeof i!="symbol"?i+"":i,e),e);var Zt=Object.defineProperty,Qt=(r,i,e)=>i in r?Zt(r,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[i]=e,De=(r,i,e)=>(Qt(r,typeof i!="symbol"?i+"":i,e),e);function Jt(r){let i=e=>{var t;for(let s in e)((t=e[s])==null?void 0:t.constructor)===Object&&(e[s]=i(e[s]));return{...e}};return i(r)}var v=class{constructor(r){r.constructor===Object?this.store=Jt(r):(this._storeIsProxy=!0,this.store=r),this.callbackMap=Object.create(null)}static warn(r,i){console.warn(`Symbiote Data: cannot ${r}. Prop name: `+i)}read(r){return!this._storeIsProxy&&!this.store.hasOwnProperty(r)?(v.warn("read",r),null):this.store[r]}has(r){return this._storeIsProxy?this.store[r]!==void 0:this.store.hasOwnProperty(r)}add(r,i,e=!1){!e&&Object.keys(this.store).includes(r)||(this.store[r]=i,this.notify(r))}pub(r,i){if(!this._storeIsProxy&&!this.store.hasOwnProperty(r)){v.warn("publish",r);return}this.store[r]=i,this.notify(r)}multiPub(r){for(let i in r)this.pub(i,r[i])}notify(r){this.callbackMap[r]&&this.callbackMap[r].forEach(i=>{i(this.store[r])})}sub(r,i,e=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(r)?(v.warn("subscribe",r),null):(this.callbackMap[r]||(this.callbackMap[r]=new Set),this.callbackMap[r].add(i),e&&i(this.store[r]),{remove:()=>{this.callbackMap[r].delete(i),this.callbackMap[r].size||delete this.callbackMap[r]},callback:i})}static registerCtx(r,i=Symbol()){let e=v.globalStore.get(i);return e?console.warn('State: context UID "'+i+'" already in use'):(e=new v(r),v.globalStore.set(i,e)),e}static deleteCtx(r){v.globalStore.delete(r)}static getCtx(r,i=!0){return v.globalStore.get(r)||(i&&console.warn('State: wrong context UID - "'+r+'"'),null)}};v.globalStore=new Map;var m=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),Qe="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",ei=Qe.length-1,ti=class{static generate(r="XXXXXXXXX-XXX"){let i="";for(let e=0;e<r.length;e++)i+=r[e]==="-"?r[e]:Qe.charAt(Math.random()*ei);return i}};function Je(r,i,e){let t=!0,s,o=i.split(".");return o.forEach((n,l)=>{l<o.length-1?r=r[n]:s=n}),r?r[s]=e:t=!1,t}function ii(r){return r.split("-").map((i,e)=>i&&e?i[0].toUpperCase()+i.slice(1):i).join("").split("_").map((i,e)=>i&&e?i.toUpperCase():i).join("")}function ri(r,i){[...r.querySelectorAll(`[${m.REPEAT_ATTR}]`)].forEach(e=>{let t=e.getAttribute(m.REPEAT_ITEM_TAG_ATTR),s;if(t&&(s=window.customElements.get(t)),!s){s=class extends i.BaseComponent{constructor(){super(),t||(this.style.display="contents")}};let n=e.innerHTML;s.template=n,s.reg(t)}for(;e.firstChild;)e.firstChild.remove();let o=e.getAttribute(m.REPEAT_ATTR);i.sub(o,n=>{if(!n){for(;e.firstChild;)e.firstChild.remove();return}let l=[...e.children],a,h=c=>{c.forEach((u,b)=>{if(l[b])if(l[b].set$)setTimeout(()=>{l[b].set$(u)});else for(let g in u)l[b][g]=u[g];else{a||(a=new DocumentFragment);let g=new s;Object.assign(g.init$,u),a.appendChild(g)}}),a&&e.appendChild(a);let d=l.slice(c.length,l.length);for(let u of d)u.remove()};if(n.constructor===Array)h(n);else if(n.constructor===Object){let c=[];for(let d in n){let u=n[d];Object.defineProperty(u,"_KEY_",{value:d,enumerable:!0}),c.push(u)}h(c)}else console.warn("Symbiote repeat data type error:"),console.log(n)}),e.removeAttribute(m.REPEAT_ATTR),e.removeAttribute(m.REPEAT_ITEM_TAG_ATTR)})}var Ye="__default__";function si(r,i){if(i.shadowRoot)return;let e=[...r.querySelectorAll("slot")];if(!e.length)return;let t={};e.forEach(s=>{let o=s.getAttribute("name")||Ye;t[o]={slot:s,fr:document.createDocumentFragment()}}),i.initChildren.forEach(s=>{var o;let n=Ye;s instanceof Element&&s.hasAttribute("slot")&&(n=s.getAttribute("slot"),s.removeAttribute("slot")),(o=t[n])==null||o.fr.appendChild(s)}),Object.values(t).forEach(s=>{if(s.fr.childNodes.length)s.slot.parentNode.replaceChild(s.fr,s.slot);else if(s.slot.childNodes.length){let o=document.createDocumentFragment();o.append(...s.slot.childNodes),s.slot.parentNode.replaceChild(o,s.slot)}else s.slot.remove()})}function oi(r,i){[...r.querySelectorAll(`[${m.EL_REF_ATTR}]`)].forEach(e=>{let t=e.getAttribute(m.EL_REF_ATTR);i.ref[t]=e,e.removeAttribute(m.EL_REF_ATTR)})}function ni(r,i){[...r.querySelectorAll(`[${m.BIND_ATTR}]`)].forEach(e=>{let s=e.getAttribute(m.BIND_ATTR).split(";");[...e.attributes].forEach(o=>{if(o.name.startsWith("-")&&o.value){let n=ii(o.name.replace("-",""));s.push(n+":"+o.value),e.removeAttribute(o.name)}}),s.forEach(o=>{if(!o)return;let n=o.split(":").map(c=>c.trim()),l=n[0],a;l.indexOf(m.ATTR_BIND_PRFX)===0&&(a=!0,l=l.replace(m.ATTR_BIND_PRFX,""));let h=n[1].split(",").map(c=>c.trim());for(let c of h){let d;c.startsWith("!!")?(d="double",c=c.replace("!!","")):c.startsWith("!")&&(d="single",c=c.replace("!","")),i.sub(c,u=>{d==="double"?u=!!u:d==="single"&&(u=!u),a?(u==null?void 0:u.constructor)===Boolean?u?e.setAttribute(l,""):e.removeAttribute(l):e.setAttribute(l,u):Je(e,l,u)||(e[m.SET_LATER_KEY]||(e[m.SET_LATER_KEY]=Object.create(null)),e[m.SET_LATER_KEY][l]=u)})}}),e.removeAttribute(m.BIND_ATTR)})}var be="{{",ne="}}",li="skip-text";function ai(r){let i,e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_TEXT,{acceptNode:s=>{var o;return!((o=s.parentElement)!=null&&o.hasAttribute(li))&&s.textContent.includes(be)&&s.textContent.includes(ne)&&1}});for(;i=t.nextNode();)e.push(i);return e}var hi=function(r,i){ai(r).forEach(t=>{let s=[],o;for(;t.textContent.includes(ne);)t.textContent.startsWith(be)?(o=t.textContent.indexOf(ne)+ne.length,t.splitText(o),s.push(t)):(o=t.textContent.indexOf(be),t.splitText(o)),t=t.nextSibling;s.forEach(n=>{let l=n.textContent.replace(be,"").replace(ne,"");n.textContent="",i.sub(l,a=>{n.textContent=a})})})},ci=[ri,si,oi,ni,hi],ve="'",Q='"',di=/\\([0-9a-fA-F]{1,6} ?)/g;function ui(r){return(r[0]===Q||r[0]===ve)&&(r[r.length-1]===Q||r[r.length-1]===ve)}function fi(r){return(r[0]===Q||r[0]===ve)&&(r=r.slice(1)),(r[r.length-1]===Q||r[r.length-1]===ve)&&(r=r.slice(0,-1)),r}function pi(r){let i="",e="";for(var t=0;t<r.length;t++){let s=r[t+1];r[t]==="\\"&&s==='"'?(i+='\\"',t++):r[t]==='"'&&e!=="\\"?i+='\\"':i+=r[t],e=r[t]}return i}function mi(r){let i=r;ui(r)&&(i=fi(i),i=i.replace(di,(e,t)=>String.fromCodePoint(parseInt(t.trim(),16))),i=i.replaceAll(`\\
`,"\\n"),i=pi(i),i=Q+i+Q);try{return JSON.parse(i)}catch{throw new Error(`Failed to parse CSS property value: ${i}. Original input: ${r}`)}}var Ze=0,Z=null,D=null,H=class extends HTMLElement{constructor(){super(),De(this,"updateCssData",()=>{var r;this.dropCssDataCache(),(r=this.__boundCssProps)==null||r.forEach(i=>{let e=this.getCssData(this.__extractCssName(i),!0);e!==null&&this.$[i]!==e&&(this.$[i]=e)})}),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return H}initCallback(){}__initCallback(){var r;this.__initialized||(this.__initialized=!0,(r=this.initCallback)==null||r.call(this))}render(r,i=this.renderShadow){let e;if((i||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.allowCustomTemplate){let s=this.getAttribute(m.USE_TPL);if(s){let o=this.getRootNode(),n=(o==null?void 0:o.querySelector(s))||document.querySelector(s);n?r=n.content.cloneNode(!0):console.warn(`Symbiote template "${s}" is not found...`)}}if(this.processInnerHtml)for(let s of this.tplProcessors)s(this,this);if(r||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(r==null?void 0:r.constructor)===DocumentFragment)e=r;else if((r==null?void 0:r.constructor)===String){let s=document.createElement("template");s.innerHTML=r,e=s.content.cloneNode(!0)}else this.constructor.__tpl&&(e=this.constructor.__tpl.content.cloneNode(!0));for(let s of this.tplProcessors)s(e,this)}let t=()=>{e&&(i&&this.shadowRoot.appendChild(e)||this.appendChild(e)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){i=!0;let s=document.createElement("link");s.rel="stylesheet",s.href=this.constructor.__shadowStylesUrl,s.onload=t,this.shadowRoot.prepend(s)}else t()}addTemplateProcessor(r){this.tplProcessors.add(r)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=ti.generate(),this.style.setProperty(m.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(m.CSS_CTX_PROP,!0)}get ctxName(){var r;let i=((r=this.getAttribute(m.CTX_NAME_ATTR))==null?void 0:r.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=i,i}get localCtx(){return this.__localCtx||(this.__localCtx=v.registerCtx({},this)),this.__localCtx}get nodeCtx(){return v.getCtx(this.ctxName,!1)||v.registerCtx({},this.ctxName)}static __parseProp(r,i){let e,t;if(r.startsWith(m.EXT_DATA_CTX_PRFX))e=i.nodeCtx,t=r.replace(m.EXT_DATA_CTX_PRFX,"");else if(r.includes(m.NAMED_DATA_CTX_SPLTR)){let s=r.split(m.NAMED_DATA_CTX_SPLTR);e=v.getCtx(s[0]),t=s[1]}else e=i.localCtx,t=r;return{ctx:e,name:t}}sub(r,i,e=!0){let t=o=>{this.isConnected&&i(o)},s=H.__parseProp(r,this);s.ctx.has(s.name)?this.allSubs.add(s.ctx.sub(s.name,t,e)):window.setTimeout(()=>{this.allSubs.add(s.ctx.sub(s.name,t,e))})}notify(r){let i=H.__parseProp(r,this);i.ctx.notify(i.name)}has(r){let i=H.__parseProp(r,this);return i.ctx.has(i.name)}add(r,i,e=!1){let t=H.__parseProp(r,this);t.ctx.add(t.name,i,e)}add$(r,i=!1){for(let e in r)this.add(e,r[e],i)}get $(){if(!this.__stateProxy){let r=Object.create(null);this.__stateProxy=new Proxy(r,{set:(i,e,t)=>{let s=H.__parseProp(e,this);return s.ctx.pub(s.name,t),!0},get:(i,e)=>{let t=H.__parseProp(e,this);return t.ctx.read(t.name)}})}return this.__stateProxy}set$(r,i=!1){for(let e in r){let t=r[e];i||![String,Number,Boolean].includes(t==null?void 0:t.constructor)?this.$[e]=t:this.$[e]!==t&&(this.$[e]=t)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(m.CTX_OWNER_ATTR)&&this.getAttribute(m.CTX_OWNER_ATTR)!=="false"}__initDataCtx(){let r=this.constructor.__attrDesc;if(r)for(let i of Object.values(r))Object.keys(this.init$).includes(i)||(this.init$[i]="");for(let i in this.init$)if(i.startsWith(m.EXT_DATA_CTX_PRFX))this.nodeCtx.add(i.replace(m.EXT_DATA_CTX_PRFX,""),this.init$[i],this.__ctxOwner);else if(i.includes(m.NAMED_DATA_CTX_SPLTR)){let e=i.split(m.NAMED_DATA_CTX_SPLTR),t=e[0].trim(),s=e[1].trim();if(t&&s){let o=v.getCtx(t,!1);o||(o=v.registerCtx({},t)),o.add(s,this.init$[i])}}else this.localCtx.add(i,this.init$[i]);for(let i in this.cssInit$)this.bindCssData(i,this.cssInit$[i]);this.__dataCtxInitialized=!0}connectedCallback(){var r;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let i=(r=this.getAttribute(m.CTX_NAME_ATTR))==null?void 0:r.trim();if(i&&this.style.setProperty(m.CSS_CTX_PROP,`'${i}'`),this.__initDataCtx(),this[m.SET_LATER_KEY]){for(let e in this[m.SET_LATER_KEY])Je(this,e,this[m.SET_LATER_KEY][e]);delete this[m.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let e of ci)this.addTemplateProcessor(e);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let e=this.getRootNode();if(!e)return;if(e==null?void 0:e.querySelector(`link[${m.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`)){this.render();return}let s=this.constructor.__rootStylesLink.cloneNode(!0);s.setAttribute(m.ROOT_STYLE_ATTR_NAME,this.constructor.is),s.onload=()=>{this.render()},e.nodeType===Node.DOCUMENT_NODE?e.head.appendChild(s):e.prepend(s)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let r of this.allSubs)r.remove(),this.allSubs.delete(r);for(let r of this.tplProcessors)this.tplProcessors.delete(r);D==null||D.delete(this.updateCssData),D!=null&&D.size||(Z==null||Z.disconnect(),Z=null,D=null)},100)))}static reg(r,i=!1){r||(Ze++,r=`${m.AUTO_TAG_PRFX}-${Ze}`),this.__tag=r;let e=window.customElements.get(r);if(e){!i&&e!==this&&console.warn([`Element with tag name "${r}" already registered.`,`You're trying to override it with another class "${this.name}".`,"This is most likely a mistake.","New element will not be registered."].join(`
`));return}window.customElements.define(r,i?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(r){this.observedAttributes=Object.keys(r),this.__attrDesc=r}attributeChangedCallback(r,i,e){var t;if(i===e)return;let s=(t=this.constructor.__attrDesc)==null?void 0:t[r];s?this.__dataCtxInitialized?this.$[s]=e:this.init$[s]=e:this[r]=e}getCssData(r,i=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(r)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let e=this.__computedStyle.getPropertyValue(r).trim();try{this.__cssDataCache[r]=mi(e)}catch{!i&&console.warn(`CSS Data error: ${r}`),this.__cssDataCache[r]=null}}return this.__cssDataCache[r]}__extractCssName(r){return r.split("--").map((i,e)=>e===0?"":i).join("--")}__initStyleAttrObserver(){D||(D=new Set),D.add(this.updateCssData),Z||(Z=new MutationObserver(r=>{r[0].type==="attributes"&&D.forEach(i=>{i()})}),Z.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}))}bindCssData(r,i=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(r);let e=this.getCssData(this.__extractCssName(r),!0);e===null&&(e=i),this.add(r,e),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(r,i,e){let t="__"+r;this[t]=this[r],Object.defineProperty(this,r,{set:s=>{this[t]=s,e?window.setTimeout(()=>{i==null||i(s)}):i==null||i(s)},get:()=>this[t]}),this[r]=this[t]}static set shadowStyles(r){let i=new Blob([r],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(i)}static set rootStyles(r){if(!this.__rootStylesLink){let i=new Blob([r],{type:"text/css"}),e=URL.createObjectURL(i),t=document.createElement("link");t.href=e,t.rel="stylesheet",this.__rootStylesLink=t}}},Ue=H;De(Ue,"template");var Fe=class{static _print(r){console.warn(r)}static setDefaultTitle(r){this.defaultTitle=r}static setRoutingMap(r){Object.assign(this.appMap,r);for(let i in this.appMap)!this.defaultRoute&&this.appMap[i].default===!0?this.defaultRoute=i:!this.errorRoute&&this.appMap[i].error===!0&&(this.errorRoute=i)}static set routingEventName(r){this.__routingEventName=r}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let r={route:null,options:{}};return window.location.search.split(this.separator).forEach(e=>{if(e.includes("?"))r.route=e.replace("?","");else if(e.includes("=")){let t=e.split("=");r.options[t[0]]=decodeURI(t[1])}else r.options[e]=!0}),r}static notify(){let r=this.readAddressBar(),i=this.appMap[r.route];if(i&&i.title&&(document.title=i.title),r.route===null&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!i&&this.errorRoute){this.applyRoute(this.errorRoute);return}else if(!i&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!i){this._print(`Route "${r.route}" not found...`);return}let e=new CustomEvent(Fe.routingEventName,{detail:{route:r.route,options:Object.assign(i||{},r.options)}});window.dispatchEvent(e)}static reflect(r,i={}){let e=this.appMap[r];if(!e){this._print("Wrong route: "+r);return}let t="?"+r;for(let o in i)i[o]===!0?t+=this.separator+o:t+=this.separator+o+`=${i[o]}`;let s=e.title||this.defaultTitle||"";window.history.pushState(null,s,t),document.title=s}static applyRoute(r,i={}){this.reflect(r,i),this.notify()}static setSeparator(r){this._separator=r}static get separator(){return this._separator||"&"}static createRouterData(r,i){this.setRoutingMap(i);let e=v.registerCtx({route:null,options:null,title:null},r);return window.addEventListener(this.routingEventName,t=>{var s;e.multiPub({route:t.detail.route,options:t.detail.options,title:((s=t.detail.options)==null?void 0:s.title)||this.defaultTitle||""})}),Fe.notify(),this.initPopstateListener(),e}static initPopstateListener(){this.__onPopstate||(this.__onPopstate=()=>{this.notify()},window.addEventListener("popstate",this.__onPopstate))}static removePopstateListener(){window.removeEventListener("popstate",this.__onPopstate),this.__onPopstate=null}};Fe.appMap=Object.create(null);var et="idb-store-ready",_i="symbiote-db",gi="symbiote-idb-update_",bi=class{_notifyWhenReady(r=null){window.dispatchEvent(new CustomEvent(et,{detail:{dbName:this.name,storeName:this.storeName,event:r}}))}get _updEventName(){return gi+this.name}_getUpdateEvent(r){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:r}})}_notifySubscribers(r){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,r),window.dispatchEvent(this._getUpdateEvent(r))}constructor(r,i){this.name=r,this.storeName=i,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=e=>{this.db=e.target.result,this.objStore=this.db.createObjectStore(i,{keyPath:"_key"}),this.objStore.transaction.oncomplete=t=>{this._notifyWhenReady(t)}},this.request.onsuccess=e=>{this.db=e.target.result,this._notifyWhenReady(e)},this.request.onerror=e=>{console.error(e)},this._subscriptionsMap={},this._updateHandler=e=>{e.key===this.name&&this._subscriptionsMap[e.newValue]&&this._subscriptionsMap[e.newValue].forEach(async s=>{s(await this.read(e.newValue))})},this._localUpdateHandler=e=>{this._updateHandler(e.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(r){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(r);return new Promise((t,s)=>{e.onsuccess=o=>{var n;(n=o.target.result)!=null&&n._value?t(o.target.result._value):(t(null),console.warn(`IDB: cannot read "${r}"`))},e.onerror=o=>{s(o)}})}write(r,i,e=!1){let t={_key:r,_value:i},o=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(t);return new Promise((n,l)=>{o.onsuccess=a=>{e||this._notifySubscribers(r),n(a.target.result)},o.onerror=a=>{l(a)}})}delete(r,i=!1){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(r);return new Promise((s,o)=>{t.onsuccess=n=>{i||this._notifySubscribers(r),s(n)},t.onerror=n=>{o(n)}})}getAll(){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((e,t)=>{i.onsuccess=s=>{let o=s.target.result;e(o.map(n=>n._value))},i.onerror=s=>{t(s)}})}subscribe(r,i){this._subscriptionsMap[r]||(this._subscriptionsMap[r]=new Set);let e=this._subscriptionsMap[r];return e.add(i),{remove:()=>{e.delete(i),e.size||delete this._subscriptionsMap[r]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,tt.clear(this.name)}},tt=class{static get readyEventName(){return et}static open(r=_i,i="store"){let e=r+"/"+i;return this._reg[e]||(this._reg[e]=new bi(r,i)),this._reg[e]}static clear(r){window.indexedDB.deleteDatabase(r);for(let i in this._reg)i.split("/")[0]===r&&delete this._reg[i]}};De(tt,"_reg",Object.create(null));var _r=Object.freeze({FILE_ADDED:"file-added",FILE_REMOVED:"file-removed",FILE_UPLOAD_START:"file-upload-start",FILE_UPLOAD_PROGRESS:"file-upload-progress",FILE_UPLOAD_SUCCESS:"file-upload-success",FILE_UPLOAD_FAILED:"file-upload-failed",FILE_URL_CHANGED:"file-url-changed",MODAL_OPEN:"modal-open",MODAL_CLOSE:"modal-close",DONE_CLICK:"done-click",UPLOAD_CLICK:"upload-click",ACTIVITY_CHANGE:"activity-change",COMMON_UPLOAD_START:"common-upload-start",COMMON_UPLOAD_PROGRESS:"common-upload-progress",COMMON_UPLOAD_SUCCESS:"common-upload-success",COMMON_UPLOAD_FAILED:"common-upload-failed",CHANGE:"change",GROUP_CREATED:"group-created"}),we=class{constructor(i){p(this,"_timeoutStore",new Map);p(this,"_targets",new Set);p(this,"_debugPrint",null);this._debugPrint=i}bindTarget(i){this._targets.add(i)}unbindTarget(i){this._targets.delete(i)}_dispatch(i,e){var t;for(let s of this._targets)s.dispatchEvent(new CustomEvent(i,{detail:e}));(t=this._debugPrint)==null||t.call(this,()=>{let s=e&&typeof e=="object"?{...e}:e;return[`event "${i}"`,s]})}emit(i,e,{debounce:t}={}){if(typeof t!="number"&&!t){this._dispatch(i,typeof e=="function"?e():e);return}this._timeoutStore.has(i)&&window.clearTimeout(this._timeoutStore.get(i));let s=typeof t=="number"?t:20,o=window.setTimeout(()=>{this._dispatch(i,typeof e=="function"?e():e),this._timeoutStore.delete(i)},s);this._timeoutStore.set(i,o)}};function A(r,i){let e,t=(...s)=>{clearTimeout(e),e=setTimeout(()=>r(...s),i)};return t.cancel=()=>{clearTimeout(e)},t}var it="--uploadcare-blocks-window-height",W=class{static registerClient(i){this.clientsRegistry.size===0&&this.attachTracker(),this.clientsRegistry.add(i)}static unregisterClient(i){this.clientsRegistry.delete(i),this.clientsRegistry.size===0&&this.detachTracker()}static attachTracker(){window.addEventListener("resize",this.flush,{passive:!0,capture:!0}),this.flush()}static detachTracker(){window.removeEventListener("resize",this.flush,{capture:!0}),document.documentElement.style.removeProperty(it)}};p(W,"clientsRegistry",new Set),p(W,"flush",A(()=>{document.documentElement.style.setProperty(it,`${window.innerHeight}px`)},100));var rt=r=>{var t;let i=new Intl.Locale(r),e="ltr";return typeof i.getTextInfo=="function"&&i.getTextInfo().direction?e=i.getTextInfo().direction:"textInfo"in i&&((t=i.textInfo)!=null&&t.direction)&&(e=i.textInfo.direction),e};var st=(r,i)=>new Intl.PluralRules(r).select(i);var vi=r=>r,ze="{{",nt="}}",ot="plural:";function je(r,i,e={}){var n;let{openToken:t=ze,closeToken:s=nt,transform:o=vi}=e;for(let l in i){let a=(n=i[l])==null?void 0:n.toString();r=r.replaceAll(t+l+s,typeof a=="string"?o(a):a)}return r}function lt(r){let i=[],e=r.indexOf(ze);for(;e!==-1;){let t=r.indexOf(nt,e),s=r.substring(e+2,t);if(s.startsWith(ot)){let o=r.substring(e+2,t).replace(ot,""),n=o.substring(0,o.indexOf("(")),l=o.substring(o.indexOf("(")+1,o.indexOf(")"));i.push({variable:s,pluralKey:n,countVariable:l})}e=r.indexOf(ze,t)}return i}var at=({element:r,attribute:i,onSuccess:e,onTimeout:t,timeout:s=300})=>{let o=r.getAttribute(i);if(o!==null){e(o);return}let n=new MutationObserver(h=>{let c=h[h.length-1];a(c)});n.observe(r,{attributes:!0,attributeFilter:[i]});let l=setTimeout(()=>{n.disconnect(),t()},s),a=h=>{let c=r.getAttribute(i);h.type==="attributes"&&h.attributeName===i&&c!==null&&(clearTimeout(l),n.disconnect(),e(c))}};var ht=()=>({});var le={"locale-id":"en","social-source-lang":"en","upload-file":"Upload file","upload-files":"Upload files","choose-file":"Choose file","choose-files":"Choose files","drop-files-here":"Drop files here","select-file-source":"Select file source",selected:"Selected",upload:"Upload","add-more":"Add more",cancel:"Cancel","start-from-cancel":"Cancel",clear:"Clear","camera-shot":"Shot","upload-url":"Import","upload-url-placeholder":"Paste link here","edit-image":"Edit image","edit-detail":"Details",back:"Back",done:"Done",ok:"Ok","remove-from-list":"Remove",no:"No",yes:"Yes","confirm-your-action":"Confirm your action","are-you-sure":"Are you sure?","selected-count":"Selected:","upload-error":"Upload error","validation-error":"Validation error","no-files":"No files selected",browse:"Browse","not-uploaded-yet":"Not uploaded yet...",file__one:"file",file__other:"files",error__one:"error",error__other:"errors","header-uploading":"Uploading {{count}} {{plural:file(count)}}","header-failed":"{{count}} {{plural:error(count)}}","header-succeed":"{{count}} {{plural:file(count)}} uploaded","header-total":"{{count}} {{plural:file(count)}} selected","src-type-local":"From device","src-type-from-url":"From link","src-type-camera":"Camera","src-type-draw":"Draw","src-type-facebook":"Facebook","src-type-dropbox":"Dropbox","src-type-gdrive":"Google Drive","src-type-gphotos":"Google Photos","src-type-instagram":"Instagram","src-type-flickr":"Flickr","src-type-vk":"VK","src-type-evernote":"Evernote","src-type-box":"Box","src-type-onedrive":"Onedrive","src-type-huddle":"Huddle","src-type-other":"Other","caption-from-url":"Import from link","caption-camera":"Camera","caption-draw":"Draw","caption-edit-file":"Edit file","file-no-name":"No name...","toggle-fullscreen":"Toggle fullscreen","toggle-guides":"Toggle guides",rotate:"Rotate","flip-vertical":"Flip vertical","flip-horizontal":"Flip horizontal",apply:"Apply",brightness:"Brightness",contrast:"Contrast",saturation:"Saturation",exposure:"Exposure",gamma:"Gamma",vibrance:"Vibrance",warmth:"Warmth",enhance:"Enhance",original:"Original",resize:"Resize image",crop:"Crop","select-color":"Select color",text:"Text",draw:"Draw","cancel-edit":"Cancel edit","tab-view":"Preview","tab-details":"Details","file-name":"Name","file-size":"Size","cdn-url":"CDN URL","file-size-unknown":"Unknown","camera-permissions-denied":"Camera access denied","camera-permissions-prompt":"Please allow access to the camera","camera-permissions-request":"Request access","files-count-limit-error-title":"Files count limit overflow","files-count-limit-error-too-few":"You\u2019ve chosen {{total}} {{plural:file(total)}}. At least {{min}} {{plural:file(min)}} required.","files-count-limit-error-too-many":"You\u2019ve chosen too many files. {{max}} {{plural:file(max)}} is maximum.","files-max-size-limit-error":"File is too big. Max file size is {{maxFileSize}}.","has-validation-errors":"File validation error ocurred. Please, check your files before upload.","images-only-accepted":"Only image files are accepted.","file-type-not-allowed":"Uploading of these file types is not allowed.","some-files-were-not-uploaded":"Some files were not uploaded."};var ye=new Map,Be=new Map,ct=(r,i)=>{ye.has(r)&&console.log(`Locale ${r} is already defined. Overwriting...`),ye.set(r,{...le,...i})},wi=(r,i)=>{Be.set(r,i)},yi=(r,i)=>{typeof i=="function"?wi(r,i):ct(r,i)},dt=async r=>{if(!ye.has(r)){if(!Be.has(r))throw new Error(`Locale ${r} is not defined`);let e=await Be.get(r)();ct(r,e)}return ye.get(r)};yi("en",le);var U=r=>`*l10n/${r}`,xi="en",xe=class{constructor(i){p(this,"_blockInstance",null);p(this,"_localeName","");p(this,"_callbacks",new Set);p(this,"_boundBlocks",new Map);this._blockInstance=i;for(let[e,t]of Object.entries(le))this._blockInstance.add(U(e),t,!1);setTimeout(()=>{i.subConfigValue("localeName",async e=>{var o;if(!this._blockInstance||!e)return;this._localeName=e;let t=await dt(e);if(e!==xi&&this._localeName!==e)return;let s=(o=this._blockInstance.cfg.localeDefinitionOverride)==null?void 0:o[e];for(let[n,l]of Object.entries(t)){let a=s==null?void 0:s[n];this._blockInstance.add(U(n),a!=null?a:l,!0);for(let h of this._callbacks)h()}}),i.subConfigValue("localeDefinitionOverride",e=>{var s;if(!e)return;let t=e[this._localeName];if(t)for(let[o,n]of Object.entries(t)){(s=this._blockInstance)==null||s.add(U(o),n,!0);for(let l of this._callbacks)l()}})})}onLocaleChange(i){let e=A(i,0);return this._callbacks.add(e),()=>{this._callbacks.delete(e)}}bindL10n(i,e,t){var o,n,l;i.$[e]=t(),this._boundBlocks.has(i)||this._boundBlocks.set(i,new Map),(n=(o=this._boundBlocks.get(i))==null?void 0:o.get(e))==null||n();let s=this.onLocaleChange(()=>{i.$[e]=t()});(l=this._boundBlocks.get(i))==null||l.set(e,s)}destroyL10nBindings(i){let e=this._boundBlocks.get(i);if(e){for(let t of e.values())t();this._boundBlocks.delete(i)}}destroy(){this._callbacks.clear()}};function ut(r,i){[...r.querySelectorAll("[l10n]")].forEach(e=>{let t=e.getAttribute("l10n");if(!t)return;let s="textContent",o=!1;if(t.includes(":")){let a=t.split(":");s=a[0],t=a[1],s.startsWith("@")&&(s=s.slice(1),o=!0)}let n=t;i.has(n)&&i.sub(n,a=>{if(!a)return;i.l10nProcessorSubs.has(n)||i.l10nProcessorSubs.set(n,new Set);let h=i.l10nProcessorSubs.get(n);h==null||h.forEach(u=>{u.remove(),h.delete(u),i.allSubs.delete(u)});let c=U(a).replace("*","");i.nodeCtx.has(c)||i.nodeCtx.add(c,a);let d=i.nodeCtx.sub(c,()=>{e[s]=i.l10n(a)});h==null||h.add(d),i.allSubs.add(d),e.removeAttribute("l10n")});let l=U(t);i.has(l)||i.add(l,""),i.sub(l,()=>{t=t,o?e.setAttribute(s,i.l10n(t)):e[s]=i.l10n(t)}),e.removeAttribute("l10n")})}var C=r=>`*cfg/${r}`;var ft=r=>{if(typeof r!="string"||!r)return"";let i=r.trim();return i.startsWith("-/")?i=i.slice(2):i.startsWith("/")&&(i=i.slice(1)),i.endsWith("/")&&(i=i.slice(0,i.length-1)),i},Ee=(...r)=>r.filter(i=>typeof i=="string"&&i).map(i=>ft(i)).join("/-/"),z=(...r)=>{let i=Ee(...r);return i?`-/${i}/`:""};function pt(r){let i=new URL(r),e=i.pathname+i.search+i.hash,t=e.lastIndexOf("http"),s=e.lastIndexOf("/"),o="";return t>=0?o=e.slice(t):s>=0&&(o=e.slice(s+1)),o}function mt(r){let i=new URL(r),{pathname:e}=i,t=e.indexOf("/"),s=e.indexOf("/",t+1);return e.substring(t+1,s)}function _t(r){let i=gt(r),e=new URL(i),t=e.pathname.indexOf("/-/");return t===-1?[]:e.pathname.substring(t).split("/-/").filter(Boolean).map(o=>ft(o))}function gt(r){let i=new URL(r),e=pt(r),t=bt(e)?vt(e).pathname:e;return i.pathname=i.pathname.replace(t,""),i.search="",i.hash="",i.toString()}function bt(r){return r.startsWith("http")}function vt(r){let i=new URL(r);return{pathname:i.origin+i.pathname||"",search:i.search||"",hash:i.hash||""}}var j=(r,i,e)=>{let t=new URL(gt(r));if(e=e||pt(r),t.pathname.startsWith("//")&&(t.pathname=t.pathname.replace("//","/")),bt(e)){let s=vt(e);t.pathname=t.pathname+(i||"")+(s.pathname||""),t.search=s.search,t.hash=s.hash}else t.pathname=t.pathname+(i||"")+(e||"");return t.toString()},Ve=(r,i)=>{let e=new URL(r);return e.pathname=i+"/",e.toString()};var He=(r,i=",")=>r.trim().split(i).map(e=>e.trim()).filter(e=>e.length>0);var S=Object.freeze({brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0,mirror:!1,flip:!1,crop:void 0}),yt=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function Ei(r,i){if(typeof i=="number"){let e=i;return S[r]!==e?`${r}/${e}`:""}if(typeof i=="boolean"){let e=i;return S[r]!==e?`${r}`:""}if(r==="filter"&&i){let{name:e,amount:t}=i;return S.filter===t?"":`${r}/${e}/${t}`}if(r==="crop"&&i){let{dimensions:e,coords:t}=i;return`${r}/${e.join("x")}/${t.join(",")}`}return""}function X(r){return Ee(...yt.filter(i=>typeof r[i]!="undefined"&&r[i]!==null).map(i=>{let e=r[i];return Ei(i,e)}).filter(i=>!!i))}var Ce=Ee("format/auto","progressive/yes"),B=([r])=>typeof r!="undefined"?Number(r):void 0,wt=()=>!0,Ci=([r,i])=>({name:r,amount:typeof i!="undefined"?Number(i):100}),Ti=([r,i])=>{if(!/\d+x\d+/.test(r)||!/\d+,\d+/.test(i))throw new Error("Crop by aspect ratio, percentage or alignment shortcuts is not supported.");return{dimensions:He(r,"x").map(Number),coords:He(i).map(Number)}},Ai=Object.freeze({enhance:B,brightness:B,exposure:B,gamma:B,contrast:B,saturation:B,vibrance:B,warmth:B,filter:Ci,mirror:wt,flip:wt,rotate:B,crop:Ti});function xt(r){let i={};for(let e of r){let[t,...s]=e.split("/");if(!yt.includes(t))continue;let o=t,n=Ai[o];try{let l=n(s);i[o]=l}catch(l){console.warn([`Failed to parse URL operation "${e}". It will be ignored.`,l instanceof Error?`Error message: "${l.message}"`:l,"If you need this functionality, please feel free to open an issue at https://github.com/uploadcare/blocks/issues/new"].join(`
`))}}return i}var w=Object.freeze({CROP:"crop",TUNING:"tuning",FILTERS:"filters"}),T=[w.CROP,w.TUNING,w.FILTERS],Et=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],Ct=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],Tt=["rotate","mirror","flip"],L=Object.freeze({brightness:{zero:S.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:S.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:S.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:S.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:S.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:S.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:S.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:S.enhance,range:[0,100],keypointsNumber:1},filter:{zero:S.filter,range:[0,100],keypointsNumber:1}});var At=r=>r?r.split(",").map(i=>i.trim()):[],Te=r=>r?r.join(","):"";var Si="https://ucarecdn.com",$i="https://upload.uploadcare.com",Oi="https://social.uploadcare.com",O={pubkey:"",multiple:!0,multipleMin:0,multipleMax:Number.MAX_SAFE_INTEGER,confirmUpload:!1,imgOnly:!1,accept:"",externalSourcesPreferredTypes:"",store:"auto",cameraMirror:!1,cameraCapture:"",sourceList:"local, url, camera, dropbox, gdrive",cloudImageEditorTabs:Te(T),maxLocalFileSizeBytes:0,thumbSize:76,showEmptyList:!1,useLocalImageEditor:!1,useCloudImageEditor:!0,removeCopyright:!1,cropPreset:"",imageShrink:"",modalScrollLock:!0,modalBackdropStrokes:!1,sourceListWrap:!0,remoteTabSessionKey:"",cdnCname:Si,baseUrl:$i,socialBaseUrl:Oi,secureSignature:"",secureExpire:"",secureDeliveryProxy:"",retryThrottledRequestMaxTimes:1,multipartMinFileSize:26214400,multipartChunkSize:5242880,maxConcurrentRequests:10,multipartMaxConcurrentRequests:4,multipartMaxAttempts:3,checkForUrlDuplicates:!1,saveUrlForRecurrentUploads:!1,groupOutput:!1,userAgentIntegration:"",debug:!1,metadata:null,localeName:"en",localeDefinitionOverride:null,iconHrefResolver:null};var Xe="lr-",_=class extends Ue{constructor(){super();p(this,"requireCtxName",!1);p(this,"allowCustomTemplate",!0);p(this,"activityType",null);p(this,"init$",ht());this.l10nProcessorSubs=new Map,this.addTemplateProcessor(ut)}l10n(e,t={}){if(!e)return"";let s=this.$[U(e)]||e,o=lt(s);for(let l of o)t[l.variable]=this.pluralize(l.pluralKey,Number(t[l.countVariable]));return je(s,t)}pluralize(e,t){let s=this.l10n("locale-id")||"en",o=st(s,t);return this.l10n(`${e}__${o}`)}bindL10n(e,t){var s;(s=this.localeManager)==null||s.bindL10n(this,e,t)}emit(e,t,s){let o=this.has("*eventEmitter")&&this.$["*eventEmitter"];o&&o.emit(e,t,s)}hasBlockInCtx(e){let t=this.$["*blocksRegistry"];for(let s of t)if(e(s))return!0;return!1}setOrAddState(e,t){this.add$({[e]:t},!0)}setActivity(e){if(this.hasBlockInCtx(t=>t.activityType===e)){this.$["*currentActivity"]=e;return}console.warn(`Activity type "${e}" not found in the context`)}connectedCallback(){let e=this.constructor.className;e&&this.classList.toggle(`${Xe}${e}`,!0),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.requireCtxName?at({element:this,attribute:"ctx-name",onSuccess:()=>{super.connectedCallback()},onTimeout:()=>{console.error("Attribute `ctx-name` is required and it is not set.")}}):super.connectedCallback(),W.registerClient(this)}disconnectedCallback(){super.disconnectedCallback(),W.unregisterClient(this)}initCallback(){this.has("*blocksRegistry")||this.add("*blocksRegistry",new Set),this.$["*blocksRegistry"].add(this),this.has("*eventEmitter")||this.add("*eventEmitter",new we(this.debugPrint.bind(this))),this.has("*localeManager")||this.add("*localeManager",new xe(this)),this.sub(U("locale-id"),t=>{this.style.direction=rt(t)})}get localeManager(){return this.has("*localeManager")?this.$["*localeManager"]:null}destroyCallback(){var t;let e=this.$["*blocksRegistry"];e.delete(this),(t=this.localeManager)==null||t.destroyL10nBindings(this),this.l10nProcessorSubs=new Map,v.deleteCtx(this),e.size===0&&setTimeout(()=>{this.destroyCtxCallback()},0)}destroyCtxCallback(){var e;v.deleteCtx(this.ctxName),(e=this.localeManager)==null||e.destroy()}fileSizeFmt(e,t=2){let s=["B","KB","MB","GB","TB"];if(e===0)return`0 ${s[0]}`;let o=1024,n=t<0?0:t,l=Math.floor(Math.log(e)/Math.log(o));return parseFloat((e/o**l).toFixed(n))+" "+s[l]}proxyUrl(e){let t=this.cfg.secureDeliveryProxy;return t?je(t,{previewUrl:e},{transform:s=>window.encodeURIComponent(s)}):e}get cfg(){if(!this.__cfgProxy){let e=Object.create(null);this.__cfgProxy=new Proxy(e,{set:(t,s,o)=>{if(typeof s!="string")return!1;let n=C(s);return this.has(n)||this.add(n,O[s]),this.$[n]=o,!0},get:(t,s)=>{let o=C(s);return this.has(o)||this.add(o,O[s]),this.$[C(s)]}})}return this.__cfgProxy}subConfigValue(e,t){let s=C(e);this.has(s)||this.add(s,O[e]),this.sub(s,t)}debugPrint(...e){if(!this.cfg.debug)return;let t=e;if(typeof(e==null?void 0:e[0])=="function"){let s=e[0];t=s()}console.log(`[${this.ctxName}]`,...t)}static reg(e){if(!e){super.reg();return}super.reg(e.startsWith(Xe)?e:Xe+e)}};p(_,"StateConsumerScope",null),p(_,"className","");var M="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";function St(...r){return r.reduce((i,e)=>{if(typeof e=="string")return i[e]=!0,i;for(let t of Object.keys(e))i[t]=e[t];return i},{})}function y(...r){let i=St(...r);return Object.keys(i).reduce((e,t)=>(i[t]&&e.push(t),e),[]).join(" ")}function $t(r,...i){let e=St(...i);for(let t of Object.keys(e))r.classList.toggle(t,e[t])}var Ot=r=>{if(!r)return[];let[i,e]=r.split(":").map(Number);if(!Number.isFinite(i)||!Number.isFinite(e)){console.error(`Invalid crop preset: ${r}`);return}return[{type:"aspect-ratio",width:i,height:e}]};var kt=r=>{if(!r)return T;let i=At(r).filter(e=>T.includes(e));return i.length===0?T:i};function It(r){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},"*cropPresetList":[],"*tabList":T,"*tabId":w.CROP,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:M,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,cropPreset:"",tabs:Te(T),"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let i=r.querySelectorAll("img");for(let e of i){let t=e.src;e.src=M,e.src=t}r.$["*networkProblems"]=!1},"*on.apply":i=>{if(!i)return;let e=r.$["*originalUrl"],t=z(X(i),"preview"),s=j(e,t),o={originalUrl:e,cdnUrlModifiers:t,cdnUrl:s,transformations:i};r.dispatchEvent(new CustomEvent("apply",{detail:o,bubbles:!0,composed:!0})),r.remove()},"*on.cancel":()=>{r.remove(),r.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}var Pt="<svg width='0' height='0' style='position:absolute'><symbol viewBox='0 0 20 20' id='uc-icon-brightness' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M15 10a5 5 0 0 1-5 5m5-5a5 5 0 0 0-5-5m5 5h-5m0 5a5 5 0 0 1 0-10m0 10V5m0 15v-3M2.93 2.929 5.05 5.05M0 10h3m-.07 7.071 2.12-2.121M10 0v3m7.07 14.071-2.12-2.121M20 10h-3m.07-7.071L14.95 5.05m-.626 2.45H10m4.324 5H10'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-closeMax' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='m3 3 14 14m0-14L3 17'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-contrast' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M2 10a8 8 0 1 0 16 0 8 8 0 1 0-16 0m8-8v16m8-8h-8m7.598 2.5H10m6.24 2.5H10m7.6-7.5H10M16.242 5H10'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-crop' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M20 14H7.005C6.45 14 6 13.55 6 12.995V0M0 6h13.067c.515 0 .933.418.933.933V20M14.5.4 13 2l1.5 1.6M13 2h2a3 3 0 0 1 3 3v2M5.5 19.6 7 18l-1.5-1.6M7 18H5a3 3 0 0 1-3-3v-2'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-done' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='m1 10.632 5.684 5.684L19 4'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-enhance' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M19 13h-2m0 0a4 4 0 0 1-4-4m4 4a4 4 0 0 0-4 4m0-8V7m0 2a4 4 0 0 1-4 4m-2 0h2m0 0a4 4 0 0 1 4 4m0 0v2M8 8.5H6.5m0 0a2 2 0 0 1-2-2m2 2a2 2 0 0 0-2 2m0-4V5m0 1.5a2 2 0 0 1-2 2M1 8.5h1.5m0 0a2 2 0 0 1 2 2m0 0V12M12 3h-1m0 0a1 1 0 0 1-1-1m1 1a1 1 0 0 0-1 1m0-2V1m0 1a1 1 0 0 1-1 1M8 3h1m0 0a1 1 0 0 1 1 1m0 0v1'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-exposure' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M10 20v-3M2.93 2.929 5.05 5.05M0 10h3m-.07 7.071 2.12-2.121M10 0v3m7.07 14.071-2.12-2.121M20 10h-3m.07-7.071L14.95 5.05M5 10a5 5 0 1 0 10 0 5 5 0 1 0-10 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-filters' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M4.5 6.5a5.5 5.5 0 1 0 11 0 5.5 5.5 0 1 0-11 0m-3.5 6a5.5 5.5 0 1 0 11 0 5.5 5.5 0 1 0-11 0m7 0a5.5 5.5 0 1 0 11 0 5.5 5.5 0 1 0-11 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-flip' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M19.6 5 18 3.5 16.4 5m3.2 10L18 16.5 16.4 15M18 3.523v12.954M3.3 8.5h10.654c.301 0 .415-.395.159-.554L3.459 1.286A.3.3 0 0 0 3 1.542V8.2a.3.3 0 0 0 .3.3zm0 3h10.654c.301 0 .415.395.159.554l-10.654 6.66A.3.3 0 0 1 3 18.458v-6.66a.3.3 0 0 1 .3-.3z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-gamma' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M17 3C9 6 2.5 11.5 2.5 17.5m0 0h1m-1 0v-1m14 1h1m-3 0h1m-3 0h1m-3 0h1m-3 0h1m-3 0h1m-3 0h1m-3-14v-1m0 3v-1m0 3v-1m0 3v-1m0 3v-1m0 3v-1m0 3v-1'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-mirror' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M5 .4 3.5 2 5 3.6M15 .4 16.5 2 15 3.6M3.52 2h12.957M8.5 16.7V6.046c0-.301-.394-.415-.554-.159L1.287 16.541a.3.3 0 0 0 .255.459H8.2a.3.3 0 0 0 .3-.3zm3 0V6.046c0-.301.395-.415.555-.159l6.659 10.654a.3.3 0 0 1-.255.459H11.8a.3.3 0 0 1-.3-.3z'/></symbol><symbol viewBox='0 0 40 40' id='uc-icon-original' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M0 40 40 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-rotate' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M13.5.4 12 2l1.5 1.6M12.023 2H14.4A3.6 3.6 0 0 1 18 5.6V8M4 17h9a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-sad' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M2 17c4.418-4 11.582-4 16 0M16.5 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-11 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-saturation' xmlns='http://www.w3.org/2000/svg'><defs><linearGradient id='ouc-icon-id__a' x1='10.001' y1='1' x2='10.001' y2='19' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient></defs><circle cx='10.001' cy='10' r='9' transform='rotate(90 10 10)' fill='url(#ouc-icon-id__a)'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-slider' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M0 10h11m0 0a2 2 0 1 0 4 0m-4 0a2 2 0 1 1 4 0m0 0h5'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-tuning' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M8 10h11M1 10h4M1 4.5h11m3 0h4m-18 11h11m3 0h4m-7-11a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0M5 10a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0m7 5.5a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-vibrance' xmlns='http://www.w3.org/2000/svg'><path d='M2.125 5.64A8.96 8.96 0 0 0 1.001 10a8.96 8.96 0 0 0 1.124 4.36V5.64z' fill='url(#ruc-icon-id__a)'/><path d='M2.875 15.499V4.502a9.053 9.053 0 0 1 1.75-1.72v14.437a9.05 9.05 0 0 1-1.75-1.72z' fill='url(#ruc-icon-id__b)'/><path d='M5.375 17.722c.548.33 1.134.601 1.75.809V1.469a8.956 8.956 0 0 0-1.75.81v15.443z' fill='url(#ruc-icon-id__c)'/><path d='M7.875 1.253v17.495c.564.136 1.15.22 1.75.244V1.008a9 9 0 0 0-1.75.245z' fill='url(#ruc-icon-id__d)'/><path d='M10.375 1.008v17.984a9 9 0 0 0 1.75-.244V1.252a9 9 0 0 0-1.75-.244z' fill='url(#ruc-icon-id__e)'/><path d='M12.875 1.469V18.53a8.957 8.957 0 0 0 1.75-.808V2.277a8.957 8.957 0 0 0-1.75-.808z' fill='url(#ruc-icon-id__f)'/><path d='M15.375 2.78v14.44a9.053 9.053 0 0 0 1.75-1.72v-11a9.054 9.054 0 0 0-1.75-1.72z' fill='url(#ruc-icon-id__g)'/><path d='M17.875 5.638v8.724A8.959 8.959 0 0 0 19.001 10a8.96 8.96 0 0 0-1.126-4.362z' fill='url(#ruc-icon-id__h)'/><defs><linearGradient id='ruc-icon-id__a' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='ruc-icon-id__b' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='ruc-icon-id__c' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='ruc-icon-id__d' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='ruc-icon-id__e' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='ruc-icon-id__f' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='ruc-icon-id__g' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='ruc-icon-id__h' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient></defs></symbol><symbol viewBox='0 0 20 20' id='uc-icon-warmth' xmlns='http://www.w3.org/2000/svg'><path d='m7.5 13.05.429.42.171-.175v-.244h-.6zm5 0h-.6v.245l.172.175.428-.42zM8.1 3.5c0-1.05.85-1.9 1.9-1.9V.4a3.1 3.1 0 0 0-3.1 3.1h1.2zm0 9.55V3.5H6.9v9.55h1.2zm-1 2.45c0-.79.315-1.506.829-2.03l-.858-.84A4.088 4.088 0 0 0 5.9 15.5h1.2zm2.9 2.9a2.9 2.9 0 0 1-2.9-2.9H5.9a4.1 4.1 0 0 0 4.1 4.1v-1.2zm2.9-2.9a2.9 2.9 0 0 1-2.9 2.9v1.2a4.1 4.1 0 0 0 4.1-4.1h-1.2zm-.829-2.03c.514.524.829 1.24.829 2.03h1.2c0-1.117-.447-2.13-1.171-2.87l-.858.84zM11.9 3.5v9.55h1.2V3.5h-1.2zM10 1.6c1.05 0 1.9.85 1.9 1.9h1.2A3.1 3.1 0 0 0 10 .4v1.2z' fill='currentColor'/><path d='M10 14V8' stroke='currentColor' stroke-width='1.2' stroke-linecap='round'/><path d='M14 3h3m-3 3h3m-3 3h3m-8 6.5a1 1 0 1 0 2 0 1 1 0 1 0-2 0' stroke='currentColor' stroke-width='1.2'/></symbol></svg>";var Lt=`${Pt} <div class="wrapper wrapper_desktop"><lr-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;"><div class="network_problems_content"><div class="network_problems_icon"><lr-icon name="sad"></lr-icon></div><div class="network_problems_text">Network error</div></div><div class="network_problems_footer"><lr-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></lr-btn-ui></div></lr-presence-toggle><div class="viewport"><div class="file_type_outer"><div class="file_type">{{fileType}}</div></div><div class="image_container" ref="img-container-el"><img src="${M}" class="image image_visible_from_editor" ref="img-el" /><lr-editor-image-cropper ref="cropper-el"></lr-editor-image-cropper><lr-editor-image-fader ref="fader-el"></lr-editor-image-fader></div><div class="info_pan">{{msg}}</div></div><div class="toolbar"><lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="toolbar_content toolbar_content__editor"><lr-editor-toolbar></lr-editor-toolbar></div></div></div>`;var G=class extends _{constructor(){super();p(this,"ctxOwner",!0);p(this,"_debouncedShowLoader",A(this._showLoader.bind(this),300));this.init$={...this.init$,...It(this)}}_showLoader(e){this.$.showLoader=e}_waitForSize(){return new Promise((t,s)=>{let o=setTimeout(()=>{s(new Error("[cloud-image-editor] timeout waiting for non-zero container size"))},3e3),n=new ResizeObserver(([l])=>{l.contentRect.width>0&&l.contentRect.height>0&&(t(),clearTimeout(o),n.disconnect())});n.observe(this)})}initCallback(){super.initCallback(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async updateImage(){if(this.isConnected){if(await this._waitForSize(),this.$.cdnUrl){let e=mt(this.$.cdnUrl),t=Ve(this.$.cdnUrl,e);if(t===this.$["*originalUrl"])return;this.$["*originalUrl"]=t;let s=_t(this.$.cdnUrl),o=xt(s);this.$["*editorTransformations"]=o}else if(this.$.uuid){let e=Ve(this.cfg.cdnCname,this.$.uuid);if(e===this.$["*originalUrl"])return;this.$["*originalUrl"]=e,this.$["*editorTransformations"]={}}else throw new Error("No UUID nor CDN URL provided");this.$["*tabId"]===w.CROP?this.$["*cropperEl"].deactivate({reset:!0}):this.$["*faderEl"].deactivate();try{let e=j(this.$["*originalUrl"],z("json")),t=await fetch(e).then(n=>n.json()),{width:s,height:o}=t;this.$["*imageSize"]={width:s,height:o},this.$["*tabId"]===w.CROP?this.$["*cropperEl"].activate(this.$["*imageSize"]):this.$["*faderEl"].activate({url:this.$["*originalUrl"]})}catch(e){e&&console.error("Failed to load image info",e)}}}async initEditor(){try{await this._waitForSize()}catch(e){this.isConnected&&console.error(e.message);return}this.ref["img-el"].addEventListener("load",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==M&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",e=>{let t=this.ref["img-el"];t.src!==e&&(this._imgLoading=!0,t.src=e||M)}),this.sub("cropPreset",e=>{this.$["*cropPresetList"]=Ot(e)}),this.sub("tabs",e=>{this.$["*tabList"]=kt(e)}),this.sub("*tabId",e=>{this.ref["img-el"].className=y("image",{image_hidden_to_cropper:e===w.CROP,image_hidden_effects:e!==w.CROP})}),this.classList.add("editor_ON"),this.sub("*networkProblems",e=>{this.$["presence.networkProblems"]=e,this.$["presence.modalCaption"]=!e}),this.sub("*editorTransformations",e=>{if(Object.keys(e).length===0)return;let t=this.$["*originalUrl"],s=z(X(e),"preview"),o=j(t,s),n={originalUrl:t,cdnUrlModifiers:s,cdnUrl:o,transformations:e};this.dispatchEvent(new CustomEvent("change",{detail:n,bubbles:!0,composed:!0}))},!1),this.sub("uuid",e=>e&&this.updateImage()),this.sub("cdnUrl",e=>e&&this.updateImage())}};p(G,"className","cloud-image-editor");G.template=Lt;G.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl","crop-preset":"cropPreset",tabs:"tabs"});var ae=33.333333333333336,f=1,Ge=24,Mt=6;function q(r,i){for(let e in i)r.setAttributeNS(null,e,i[e].toString())}function $(r,i={}){let e=document.createElementNS("http://www.w3.org/2000/svg",r);return q(e,i),e}function Nt(r,i,e){let{x:t,y:s,width:o,height:n}=r,l=i.includes("w")?0:1,a=i.includes("n")?0:1,h=[-1,1][l],c=[-1,1][a],d=[t+l*o+1.5*h,s+a*n+1.5*c-24*e*c],u=[t+l*o+1.5*h,s+a*n+1.5*c],b=[t+l*o-24*e*h+1.5*h,s+a*n+1.5*c];return{d:`M ${d[0]} ${d[1]} L ${u[0]} ${u[1]} L ${b[0]} ${b[1]}`,center:u}}function Rt(r,i,e){let{x:t,y:s,width:o,height:n}=r,l=["n","s"].includes(i)?.5:{w:0,e:1}[i],a=["w","e"].includes(i)?.5:{n:0,s:1}[i],h=[-1,1][l],c=[-1,1][a],d,u;["n","s"].includes(i)?(d=[t+l*o-34*e/2,s+a*n+1.5*c],u=[t+l*o+34*e/2,s+a*n+1.5*c]):(d=[t+l*o+1.5*h,s+a*n-34*e/2],u=[t+l*o+1.5*h,s+a*n+34*e/2]);let b=`M ${d[0]} ${d[1]} L ${u[0]} ${u[1]}`,g=[u[0]-(u[0]-d[0])/2,u[1]-(u[1]-d[1])/2];return{d:b,center:g}}function Ft(r){return r===""?"move":["e","w"].includes(r)?"ew-resize":["n","s"].includes(r)?"ns-resize":["nw","se"].includes(r)?"nwse-resize":"nesw-resize"}function Dt({rect:r,delta:[i,e],imageBox:t}){return ee({...r,x:r.x+i,y:r.y+e},t)}function ee(r,i){let{x:e}=r,{y:t}=r;return r.x<i.x?e=i.x:r.x+r.width>i.x+i.width&&(e=i.x+i.width-r.width),r.y<i.y?t=i.y:r.y+r.height>i.y+i.height&&(t=i.y+i.height-r.height),{...r,x:e,y:t}}function ki({rect:r,delta:i,aspectRatio:e,imageBox:t}){let[,s]=i,{y:o,width:n,height:l}=r;o+=s,l-=s,e&&(n=l*e);let a=r.x+r.width/2-n/2;return o<=t.y&&(o=t.y,l=r.y+r.height-o,e&&(n=l*e,a=r.x+r.width/2-n/2)),a<=t.x&&(a=t.x,o=r.y+r.height-l),a+n>=t.x+t.width&&(a=Math.max(t.x,t.x+t.width-n),n=t.x+t.width-a,e&&(l=n/e),o=r.y+r.height-l),l<f&&(l=f,e&&(n=l*e,a=r.x+r.width/2-n/2),o=r.y+r.height-l),n<f&&(n=f,e&&(l=n/e,a=r.x+r.width/2-n/2),o=r.y+r.height-l),{x:a,y:o,width:n,height:l}}function Ii({rect:r,delta:i,aspectRatio:e,imageBox:t}){let[s]=i,{x:o,width:n,height:l}=r;o+=s,n-=s,e&&(l=n/e);let a=r.y+r.height/2-l/2;return o<=t.x&&(o=t.x,n=r.x+r.width-o,e&&(l=n/e,a=r.y+r.height/2-l/2)),a<=t.y&&(a=t.y,o=r.x+r.width-n),a+l>=t.y+t.height&&(a=Math.max(t.y,t.y+t.height-l),l=t.y+t.height-a,e&&(n=l*e),o=r.x+r.width-n),l<f&&(l=f,e&&(n=l*e),a=r.y+r.height/2-l/2,o=r.x+r.width-n),n<f&&(n=f,e&&(l=n/e),a=r.y+r.height/2-l/2,o=r.x+r.width-n),{x:o,y:a,width:n,height:l}}function Pi({rect:r,delta:i,aspectRatio:e,imageBox:t}){let[,s]=i,{y:o,width:n,height:l}=r;l+=s,e&&(n=l*e);let a=r.x+r.width/2-n/2;return o+l>=t.y+t.height&&(l=t.y+t.height-o,e&&(n=l*e),a=r.x+r.width/2-n/2),a<=t.x&&(a=t.x,o=r.y),a+n>=t.x+t.width&&(a=Math.max(t.x,t.x+t.width-n),n=t.x+t.width-a,e&&(l=n/e),o=r.y),l<f&&(l=f,e&&(n=l*e),a=r.x+r.width/2-n/2),n<f&&(n=f,e&&(l=n/e),a=r.x+r.width/2-n/2),{x:a,y:o,width:n,height:l}}function Li({rect:r,delta:i,aspectRatio:e,imageBox:t}){let[s]=i,{x:o,width:n,height:l}=r;n+=s,e&&(l=n/e);let a=r.y+r.height/2-l/2;return o+n>=t.x+t.width&&(n=t.x+t.width-o,e&&(l=n/e),a=r.y+r.height/2-l/2),a<=t.y&&(a=t.y,o=r.x),a+l>=t.y+t.height&&(a=Math.max(t.y,t.y+t.height-l),l=t.y+t.height-a,e&&(n=l*e),o=r.x),l<f&&(l=f,e&&(n=l*e),a=r.y+r.height/2-l/2),n<f&&(n=f,e&&(l=n/e),a=r.y+r.height/2-l/2),{x:o,y:a,width:n,height:l}}function Mi({rect:r,delta:i,aspectRatio:e,imageBox:t}){let[s,o]=i,{x:n,y:l,width:a,height:h}=r;return n+s<t.x&&(s=t.x-n),l+o<t.y&&(o=t.y-l),n+=s,a-=s,l+=o,h-=o,e&&Math.abs(a/h)>e?(o=a/e-h,h+=o,l-=o,l<=t.y&&(h=h-(t.y-l),a=h*e,n=r.x+r.width-a,l=t.y)):e&&(s=h*e-a,a=a+s,n-=s,n<=t.x&&(a=a-(t.x-n),h=a/e,n=t.x,l=r.y+r.height-h)),h<f&&(h=f,e&&(a=h*e),n=r.x+r.width-a,l=r.y+r.height-h),a<f&&(a=f,e&&(h=a/e),n=r.x+r.width-a,l=r.y+r.height-h),{x:n,y:l,width:a,height:h}}function Ni({rect:r,delta:i,aspectRatio:e,imageBox:t}){let[s,o]=i,{x:n,y:l,width:a,height:h}=r;return n+a+s>t.x+t.width&&(s=t.x+t.width-n-a),l+o<t.y&&(o=t.y-l),a+=s,l+=o,h-=o,e&&Math.abs(a/h)>e?(o=a/e-h,h+=o,l-=o,l<=t.y&&(h=h-(t.y-l),a=h*e,n=r.x,l=t.y)):e&&(s=h*e-a,a+=s,n+a>=t.x+t.width&&(a=t.x+t.width-n,h=a/e,n=t.x+t.width-a,l=r.y+r.height-h)),h<f&&(h=f,e&&(a=h*e),l=r.y+r.height-h),a<f&&(a=f,e&&(h=a/e),l=r.y+r.height-h),{x:n,y:l,width:a,height:h}}function Ri({rect:r,delta:i,aspectRatio:e,imageBox:t}){let[s,o]=i,{x:n,y:l,width:a,height:h}=r;return n+s<t.x&&(s=t.x-n),l+h+o>t.y+t.height&&(o=t.y+t.height-l-h),n+=s,a-=s,h+=o,e&&Math.abs(a/h)>e?(o=a/e-h,h+=o,l+h>=t.y+t.height&&(h=t.y+t.height-l,a=h*e,n=r.x+r.width-a,l=t.y+t.height-h)):e&&(s=h*e-a,a+=s,n-=s,n<=t.x&&(a=a-(t.x-n),h=a/e,n=t.x,l=r.y)),h<f&&(h=f,e&&(a=h*e),n=r.x+r.width-a),a<f&&(a=f,e&&(h=a/e),n=r.x+r.width-a),{x:n,y:l,width:a,height:h}}function Fi({rect:r,delta:i,aspectRatio:e,imageBox:t}){let[s,o]=i,{x:n,y:l,width:a,height:h}=r;return n+a+s>t.x+t.width&&(s=t.x+t.width-n-a),l+h+o>t.y+t.height&&(o=t.y+t.height-l-h),a+=s,h+=o,e&&Math.abs(a/h)>e?(o=a/e-h,h+=o,l+h>=t.y+t.height&&(h=t.y+t.height-l,a=h*e,n=r.x,l=t.y+t.height-h)):e&&(s=h*e-a,a+=s,n+a>=t.x+t.width&&(a=t.x+t.width-n,h=a/e,n=t.x+t.width-a,l=r.y)),h<f&&(h=f,e&&(a=h*e)),a<f&&(a=f,e&&(h=a/e)),{x:n,y:l,width:a,height:h}}function Ut({direction:r,...i}){switch(r){case"n":return ki(i);case"w":return Ii(i);case"s":return Pi(i);case"e":return Li(i);case"nw":return Mi(i);case"ne":return Ni(i);case"sw":return Ri(i);case"se":return Fi(i);default:return i.rect}}function zt(r,[i,e]){return r.x<=i&&i<=r.x+r.width&&r.y<=e&&e<=r.y+r.height}function jt(r,i){return r.x>=i.x&&r.y>=i.y&&r.x+r.width<=i.x+i.width&&r.y+r.height<=i.y+i.height}function Bt(r,i){return Math.abs(r.width/r.height-i)<.1}function te({width:r,height:i},e){let t=e/90%2!==0;return{width:t?i:r,height:t?r:i}}function ie(r){return{x:Math.round(r.x),y:Math.round(r.y),width:Math.round(r.width),height:Math.round(r.height)}}function K(r,i,e){return Math.min(Math.max(r,i),e)}var Se=class extends _{constructor(){super(),this.init$={...this.init$,dragging:!1},this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(i){let e=this.$["*imageBox"];if(!e)return;if(i===""&&e.height<=f&&e.width<=f)return!0;let t=e.height<=f&&(i.includes("n")||i.includes("s")),s=e.width<=f&&(i.includes("e")||i.includes("w"));return t||s}_createBackdrop(){let i=this.$["*cropBox"];if(!i)return;let{x:e,y:t,width:s,height:o}=i,n=this.ref["svg-el"],l=$("mask",{id:"backdrop-mask"}),a=$("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),h=$("rect",{x:e,y:t,width:s,height:o,fill:"black"});l.appendChild(a),l.appendChild(h);let c=$("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});n.appendChild(c),n.appendChild(l),this._backdropMask=l,this._backdropMaskInner=h}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask&&(this._backdropMask.style.display="block")}))}_updateBackdrop(){let i=this.$["*cropBox"];if(!i)return;let{x:e,y:t,width:s,height:o}=i;this._backdropMaskInner&&q(this._backdropMaskInner,{x:e,y:t,width:s,height:o})}_updateFrame(){let i=this.$["*cropBox"];if(!(!i||!this._frameGuides||!this._frameThumbs)){for(let e of Object.values(this._frameThumbs)){let{direction:t,pathNode:s,interactionNode:o,groupNode:n}=e,l=t==="",a=t.length===2,{x:h,y:c,width:d,height:u}=i;if(l){let g={x:h+d/3,y:c+u/3,width:d/3,height:u/3};q(o,g)}else{let g=K(Math.min(d,u)/(24*2+34)/2,0,1),{d:k,center:I}=a?Nt(i,t,g):Rt(i,t,g),P=Math.max(Ge*K(Math.min(d,u)/Ge/3,0,1),Mt);q(o,{x:I[0]-P,y:I[1]-P,width:P*2,height:P*2}),q(s,{d:k})}let b=this._shouldThumbBeDisabled(t);n.setAttribute("class",y("thumb",{"thumb--hidden":b,"thumb--visible":!b}))}q(this._frameGuides,{x:i.x-1*.5,y:i.y-1*.5,width:i.width+1,height:i.height+1})}}_createThumbs(){let i={};for(let e=0;e<3;e++)for(let t=0;t<3;t++){let s=`${["n","","s"][e]}${["w","","e"][t]}`,o=$("g");o.classList.add("thumb"),o.setAttribute("with-effects","");let n=$("rect",{fill:"transparent"}),l=$("path",{stroke:"currentColor",fill:"none","stroke-width":3});o.appendChild(l),o.appendChild(n),i[s]={direction:s,pathNode:l,interactionNode:n,groupNode:o},n.addEventListener("pointerdown",this._handlePointerDown.bind(this,s))}return i}_createGuides(){let i=$("svg"),e=$("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});i.appendChild(e);for(let t=1;t<=2;t++){let s=$("line",{x1:`${ae*t}%`,y1:"0%",x2:`${ae*t}%`,y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});i.appendChild(s)}for(let t=1;t<=2;t++){let s=$("line",{x1:"0%",y1:`${ae*t}%`,x2:"100%",y2:`${ae*t}%`,stroke:"#000000","stroke-width":1,"stroke-opacity":.3});i.appendChild(s)}return i.classList.add("guides","guides--semi-hidden"),i}_createFrame(){let i=this.ref["svg-el"],e=document.createDocumentFragment(),t=this._createGuides();e.appendChild(t);let s=this._createThumbs();for(let{groupNode:o}of Object.values(s))e.appendChild(o);i.appendChild(e),this._frameThumbs=s,this._frameGuides=t}_handlePointerDown(i,e){if(!this._frameThumbs)return;let t=this._frameThumbs[i];if(this._shouldThumbBeDisabled(i))return;let s=this.$["*cropBox"],{x:o,y:n}=this.ref["svg-el"].getBoundingClientRect(),l=e.x-o,a=e.y-n;this.$.dragging=!0,this._draggingThumb=t,this._dragStartPoint=[l,a],this._dragStartCrop={...s}}_handlePointerUp_(i){this._updateCursor(),this.$.dragging&&(i.stopPropagation(),i.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(i){if(!this.$.dragging||!this._dragStartPoint||!this._draggingThumb)return;i.stopPropagation(),i.preventDefault();let e=this.ref["svg-el"],{x:t,y:s}=e.getBoundingClientRect(),o=i.x-t,n=i.y-s,l=o-this._dragStartPoint[0],a=n-this._dragStartPoint[1],{direction:h}=this._draggingThumb,c=this._calcCropBox(h,[l,a]);c&&(this.$["*cropBox"]=c)}_calcCropBox(i,e){var h,c;let[t,s]=e,o=this.$["*imageBox"],n=(h=this._dragStartCrop)!=null?h:this.$["*cropBox"],l=(c=this.$["*cropPresetList"])==null?void 0:c[0],a=l?l.width/l.height:void 0;if(i===""?n=Dt({rect:n,delta:[t,s],imageBox:o}):n=Ut({rect:n,delta:[t,s],direction:i,aspectRatio:a,imageBox:o}),!Object.values(n).every(d=>Number.isFinite(d)&&d>=0)){console.error("CropFrame is trying to create invalid rectangle",{payload:n});return}return ee(ie(n),this.$["*imageBox"])}_handleSvgPointerMove_(i){if(!this._frameThumbs)return;let e=Object.values(this._frameThumbs).find(t=>{if(this._shouldThumbBeDisabled(t.direction))return!1;let o=t.interactionNode.getBoundingClientRect(),n={x:o.x,y:o.y,width:o.width,height:o.height};return zt(n,[i.x,i.y])});this._hoverThumb=e,this._updateCursor()}_updateCursor(){let i=this._hoverThumb;this.ref["svg-el"].style.cursor=i?Ft(i.direction):"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(i){this._frameThumbs&&Object.values(this._frameThumbs).map(({groupNode:e})=>e).forEach(e=>{e.setAttribute("class",y("thumb",{"thumb--hidden":!i,"thumb--visible":i}))})}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",i=>{i&&(this._guidesHidden=i.height<=f||i.width<=f,window.requestAnimationFrame(()=>{this._render()}))}),this.sub("dragging",i=>{this._frameGuides&&this._frameGuides.setAttribute("class",y({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&i,"guides--semi-hidden":!this._guidesHidden&&!i}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}};Se.template='<svg class="svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg>';var V=class extends _{constructor(){super(...arguments);p(this,"init$",{...this.init$,active:!1,title:"",icon:"","on.click":null})}initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.sub("title",e=>{this._titleEl&&(this._titleEl.style.display=e?"block":"none")}),this.sub("active",e=>{this.className=y({active:e,not_active:!e})}),this.sub("on.click",e=>{this.onclick=e})}};V.template=`<div class="before"></div><lr-icon set="@name: icon;"></lr-icon><div class="title" ref="title-el">{{title}}</div>`;function Ui(r){let i=r+90;return i=i>=360?0:i,i}function zi(r,i){return r==="rotate"?Ui(i):["mirror","flip"].includes(r)?!i:null}var he=class extends V{initCallback(){super.initCallback(),this.defineAccessor("operation",i=>{i&&(this._operation=i,this.$.icon=i)}),this.$["on.click"]=i=>{let e=this.$["*cropperEl"].getValue(this._operation),t=zi(this._operation,e);this.$["*cropperEl"].setValue(this._operation,t)}}};var ce={FILTER:"filter",COLOR_OPERATION:"color_operation"},R="original",$e=class extends _{constructor(){super(...arguments);p(this,"init$",{...this.init$,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":e=>{this.$["*faderEl"].set(e),this.$.value=e}})}setOperation(e,t){this._controlType=e==="filter"?ce.FILTER:ce.COLOR_OPERATION,this._operation=e,this._iconName=e,this._title=e.toUpperCase(),this._filter=t,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===R?void 0:this.$.value,filter:this._filter===R?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:e,zero:t}=L[this._operation],[s,o]=e;this.$.min=s,this.$.max=o,this.$.zero=t;let n=this.$["*editorTransformations"][this._operation];if(this._controlType===ce.FILTER){let l=o;if(n){let{name:a,amount:h}=n;l=a===this._filter?h:o}this.$.value=l,this.$.defaultValue=l}if(this._controlType===ce.COLOR_OPERATION){let l=typeof n!="undefined"?n:t;this.$.value=l,this.$.defaultValue=l}}apply(){let e;this._controlType===ce.FILTER?this._filter===R?e=null:e={name:this._filter,amount:this.$.value}:e=this.$.value;let t={...this.$["*editorTransformations"],[this._operation]:e};this.$["*editorTransformations"]=t}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",e=>{this._originalUrl=e}),this.sub("value",e=>{let t=`${this._filter||this._operation} ${e}`;this.$["*operationTooltip"]=t})}};$e.template=`<lr-slider-ui ref="slider-el" set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;" ></lr-slider-ui>`;function de(r){let i=new Image;return{promise:new Promise((s,o)=>{i.src=r,i.onload=s,i.onerror=o}),image:i,cancel:()=>{i.naturalWidth===0&&(i.src=M)}}}function ue(r){let i=[];for(let o of r){let n=de(o);i.push(n)}let e=i.map(o=>o.image);return{promise:Promise.allSettled(i.map(o=>o.promise)),images:e,cancel:()=>{i.forEach(o=>{o.cancel()})}}}var re=class extends V{constructor(){super(...arguments);p(this,"init$",{...this.init$,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null})}_previewSrc(){let e=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),t=window.devicePixelRatio,s=Math.ceil(t*e),o=t>=2?"lightest":"normal",n=100,l={...this.$["*editorTransformations"]};return l[this._operation]=this._filter!==R?{name:this._filter,amount:n}:void 0,j(this._originalUrl,z(Ce,X(l),`quality/${o}`,`scale_crop/${s}x${s}/center`))}_observerCallback(e,t){if(e[0].isIntersecting){let o=this.proxyUrl(this._previewSrc()),n=this.ref["preview-el"],{promise:l,cancel:a}=de(o);this._cancelPreload=a,l.catch(h=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:h})}).finally(()=>{n.style.backgroundImage=`url(${o})`,n.setAttribute("loaded",""),t.unobserve(this)})}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",t=>{this._operation="filter",this._filter=t,this.$.isOriginal=t===R,this.$.icon=this.$.isOriginal?"original":"slider"}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let e=this.$["*originalUrl"];this._originalUrl=e,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",t=>{this.$.active=t&&t===this._filter}),this.sub("isOriginal",t=>{this.$.iconSize=t?40:20}),this.sub("active",t=>{if(this.$.isOriginal)return;let s=this.ref["icon-el"];s.style.opacity=t?"1":"0";let o=this.ref["preview-el"];t?o.style.opacity="0":o.style.backgroundImage&&(o.style.opacity="1")}),this.sub("*networkProblems",t=>{if(!t){let s=this.proxyUrl(this._previewSrc()),o=this.ref["preview-el"];o.style.backgroundImage&&(o.style.backgroundImage="none",o.style.backgroundImage=`url(${s})`)}})}destroyCallback(){var e;super.destroyCallback(),(e=this._observer)==null||e.disconnect(),this._cancelPreload&&this._cancelPreload()}};re.template=`<div class="before"></div><div class="preview" ref="preview-el"></div><lr-icon ref="icon-el" set="@name: icon; @size: iconSize;"></lr-icon>`;var fe=class extends V{constructor(){super(...arguments);p(this,"_operation","")}initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",e=>{e&&(this._operation=e,this.$.icon=e,this.bindL10n("title",()=>this.l10n(e)))}),this.sub("*editorTransformations",e=>{if(!this._operation)return;let{zero:t}=L[this._operation],s=e[this._operation],o=typeof s!="undefined"?s!==t:!1;this.$.active=o})}};var Vt=(r,i)=>{let e,t,s,o=(...n)=>{e?(clearTimeout(t),t=setTimeout(()=>{Date.now()-s>=i&&(r(...n),s=Date.now())},Math.max(i-(Date.now()-s),0))):(r(...n),s=Date.now(),e=!0)};return Object.defineProperty(o,"cancel",{configurable:!1,writable:!1,enumerable:!1,value:()=>{clearTimeout(t)}}),o};function Ht(r,i){let e={};for(let t of i){let s=r[t];(r.hasOwnProperty(t)||s!==void 0)&&(e[t]=s)}return e}function se(r,i,e){let s=window.devicePixelRatio,o=Math.min(Math.ceil(i*s),3e3),n=s>=2?"lightest":"normal";return j(r,z(Ce,X(e),`quality/${n}`,`stretch/off/-/resize/${o}x`))}function ji(r){return r?[({dimensions:e,coords:t})=>[...e,...t].every(s=>Number.isInteger(s)&&Number.isFinite(s)),({dimensions:e,coords:t})=>e.every(s=>s>0)&&t.every(s=>s>=0)].every(e=>e(r)):!0}var Oe=class extends _{constructor(){super();p(this,"ctxOwner",!0);this.init$={...this.init$,image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}},this._commitDebounced=A(this._commit.bind(this),300),this._handleResizeThrottled=Vt(this._handleResize.bind(this),100),this._imageSize={width:0,height:0}}_handleResize(){!this.isConnected||!this._isActive||(this._initCanvas(),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw())}_syncTransformations(){let e=this.$["*editorTransformations"],t=Ht(e,Object.keys(this.$["*operations"])),s={...this.$["*operations"],...t};this.$["*operations"]=s}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),s=this.offsetWidth,o=this.offsetHeight,n=window.devicePixelRatio;e.style.width=`${s}px`,e.style.height=`${o}px`,e.width=s*n,e.height=o*n,t==null||t.scale(n,n),this._canvas=e,this._ctx=t}_alignImage(){if(!this._isActive||!this.$.image)return;let e=this.$.image,t=this.$["*padding"],s=this.$["*operations"],{rotate:o}=s,n={width:this.offsetWidth,height:this.offsetHeight},l=te({width:e.naturalWidth,height:e.naturalHeight},o),a;if(l.width>n.width-t*2||l.height>n.height-t*2){let h=l.width/l.height,c=n.width/n.height;if(h>c){let d=n.width-t*2,u=d/h,b=0+t,g=t+(n.height-t*2)/2-u/2;a={x:b,y:g,width:d,height:u}}else{let d=n.height-t*2,u=d*h,b=t+(n.width-t*2)/2-u/2,g=0+t;a={x:b,y:g,width:u,height:d}}}else{let{width:h,height:c}=l,d=t+(n.width-t*2)/2-h/2,u=t+(n.height-t*2)/2-c/2;a={x:d,y:u,width:h,height:c}}this.$["*imageBox"]=ie(a)}_alignCrop(){var u;let e=this.$["*cropBox"],t=this.$["*imageBox"],s=this.$["*operations"],{rotate:o}=s,n=this.$["*editorTransformations"].crop,{width:l,x:a,y:h}=this.$["*imageBox"];if(n){let{dimensions:[b,g],coords:[k,I]}=n,{width:P}=te(this._imageSize,o),ge=l/P;e=ee(ie({x:a+k*ge,y:h+I*ge,width:b*ge,height:g*ge}),this.$["*imageBox"])}let c=(u=this.$["*cropPresetList"])==null?void 0:u[0],d=c?c.width/c.height:void 0;if(!jt(e,t)||d&&!Bt(e,d)){let b=t.width/t.height,g=t.width,k=t.height;d&&(b>d?g=Math.min(t.height*d,t.width):k=Math.min(t.width/d,t.height)),e={x:t.x+t.width/2-g/2,y:t.y+t.height/2-k/2,width:g,height:k}}this.$["*cropBox"]=ee(ie(e),this.$["*imageBox"])}_drawImage(){let e=this._ctx;if(!e)return;let t=this.$.image,s=this.$["*imageBox"],o=this.$["*operations"],{mirror:n,flip:l,rotate:a}=o,h=te({width:s.width,height:s.height},a);e.save(),e.translate(s.x+s.width/2,s.y+s.height/2),e.rotate(a*Math.PI*-1/180),e.scale(n?-1:1,l?-1:1),e.drawImage(t,-h.width/2,-h.height/2,h.width,h.height),e.restore()}_draw(){if(!this._isActive||!this.$.image||!this._canvas||!this._ctx)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout(()=>{this.className=y({active_from_viewer:e,active_from_editor:!e,inactive_to_editor:!1})}))}_getCropDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],s=this.$["*operations"],{rotate:o}=s,{width:n,height:l}=t,{width:a,height:h}=te(this._imageSize,o),{width:c,height:d}=e,u=n/a,b=l/h;return[K(Math.round(c/u),1,a),K(Math.round(d/b),1,h)]}_getCropTransformation(){let e=this.$["*cropBox"],t=this.$["*imageBox"],s=this.$["*operations"],{rotate:o}=s,{width:n,height:l,x:a,y:h}=t,{width:c,height:d}=te(this._imageSize,o),{x:u,y:b}=e,g=n/c,k=l/d,I=this._getCropDimensions(),P={dimensions:I,coords:[K(Math.round((u-a)/g),0,c-I[0]),K(Math.round((b-h)/k),0,d-I[1])]};if(!ji(P)){console.error("Cropper is trying to create invalid crop object",{payload:P});return}if(!(I[0]===c&&I[1]===d))return P}_commit(){if(!this.isConnected||!this._imageSize)return;let e=this.$["*operations"],{rotate:t,mirror:s,flip:o}=e,n=this._getCropTransformation(),a={...this.$["*editorTransformations"],crop:n,rotate:t,mirror:s,flip:o};this.$["*editorTransformations"]=a}setValue(e,t){this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}={}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset);try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._animateIn({fromViewer:t})}catch(s){console.error("Failed to activate cropper",{error:s})}this._observer=new ResizeObserver(([s])=>{s.contentRect.width>0&&s.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeThrottled()}),this._observer.observe(this)}}deactivate({reset:e=!1}={}){var t;this._isActive&&(!e&&this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=y({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}),(t=this._observer)==null||t.disconnect())}_transitionToCrop(){let e=this._getCropDimensions(),t=Math.min(this.offsetWidth,e[0])/this.$["*cropBox"].width,s=Math.min(this.offsetHeight,e[1])/this.$["*cropBox"].height,o=Math.min(t,s),n=this.$["*cropBox"].x+this.$["*cropBox"].width/2,l=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${o}) translate(${(this.offsetWidth/2-n)/o}px, ${(this.offsetHeight/2-l)/o}px)`,this.style.transformOrigin=`${n}px ${l}px`}_transitionToImage(){let e=this.$["*cropBox"].x+this.$["*cropBox"].width/2,t=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${e}px ${t}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(e,t){let s=this.offsetWidth;t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let o=this.proxyUrl(se(e,s,t)),{promise:n,cancel:l,image:a}=de(o),h=this._handleImageLoading(o);return a.addEventListener("load",h,{once:!0}),a.addEventListener("error",h,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=l,n.then(()=>a).catch(c=>(console.error("Failed to load image",{error:c}),this.$["*networkProblems"]=!0,Promise.resolve(a)))}_handleImageLoading(e){let t="crop",s=this.$["*loadingOperations"];return s.get(t)||s.set(t,new Map),s.get(t).get(e)||(s.set(t,s.get(t).set(e,!0)),this.$["*loadingOperations"]=s),()=>{var o;(o=s==null?void 0:s.get(t))!=null&&o.has(e)&&(s.get(t).delete(e),this.$["*loadingOperations"]=s)}}initCallback(){super.initCallback(),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",()=>{this.$.image&&this._commitDebounced()}),this.sub("*cropPresetList",()=>{this._alignCrop()}),setTimeout(()=>{this.sub("*networkProblems",e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}destroyCallback(){var e;super.destroyCallback(),(e=this._observer)==null||e.disconnect()}};Oe.template=`<canvas class="canvas" ref="canvas-el"></canvas><lr-crop-frame ref="frame-el"></lr-crop-frame>`;function Ke(r,i,e){let t=Array(e);e--;for(let s=e;s>=0;s--)t[s]=Math.ceil((s*i+(e-s)*r)/e);return t}function Bi(r){return r.reduce((i,e,t)=>t<r.length-1?[...i,[e,r[t+1]]]:i,[])}function Vi(r,i,e){let t=Bi(r).find(([s,o])=>s<=i&&i<=o);return r.map(s=>{let o=Math.abs(t[0]-t[1]),n=Math.abs(i-t[0])/o;return t[0]===s?i>e?1:1-n:t[1]===s?i>=e?n:1:0})}function Hi(r,i){return r.map((e,t)=>e<i?r.length-t:t)}function Xt(r,i){let e=L[r].keypointsNumber,{range:t,zero:s}=L[r];return[...new Set([...Ke(t[0],s,e+1),...Ke(s,t[1],e+1),s,i])].sort((o,n)=>o-n)}var We=class extends _{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=A(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(i){let e=this._operation,t=this.$["*loadingOperations"];return t.get(e)||t.set(e,new Map),t.get(e).get(i)||(t.set(e,t.get(e).set(i,!0)),this.$["*loadingOperations"]=t),()=>{var s;(s=t==null?void 0:t.get(e))!=null&&s.has(i)&&(t.get(e).delete(i),this.$["*loadingOperations"]=t)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let i of this._keypoints){let{image:e}=i;e&&(e.style.opacity=i.opacity.toString(),e.style.zIndex=i.zIndex.toString())}})}_imageSrc({url:i=this._url,filter:e=this._filter,operation:t,value:s}={}){let o={...this._transformations};t&&(o[t]=e?{name:e,amount:s}:s);let n=this.offsetWidth;return this.proxyUrl(se(i,n,o))}_constructKeypoint(i,e){return{src:this._imageSrc({operation:i,value:e}),image:null,opacity:0,zIndex:0,value:e}}_isSame(i,e){return this._operation===i&&this._filter===e}_addKeypoint(i,e,t){let s=()=>!this._isSame(i,e)||this._value!==t||!!this._keypoints.find(a=>a.value===t);if(s())return;let o=this._constructKeypoint(i,t),n=new Image;n.src=o.src;let l=this._handleImageLoading(o.src);n.addEventListener("load",l,{once:!0}),n.addEventListener("error",l,{once:!0}),o.image=n,n.classList.add("fader-image"),n.addEventListener("load",()=>{if(s())return;let a=this._keypoints,h=a.findIndex(d=>d.value>t),c=h<a.length?a[h].image:null;!this._container||c&&!this._container.contains(c)||(a.splice(h,0,o),this._container.insertBefore(n,c),this._update(i,t))},{once:!0}),n.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(i){i=typeof i=="string"?parseInt(i,10):i,this._update(this._operation,i),this._addKeypointDebounced(this._operation,this._filter,i)}_update(i,e){this._operation=i,this._value=e;let{zero:t}=L[i],s=this._keypoints.map(l=>l.value),o=Vi(s,e,t),n=Hi(s,t);for(let[l,a]of Object.entries(this._keypoints))a.opacity=o[l],a.zIndex=n[l];this._flush()}_createPreviewImage(){let i=new Image;return i.classList.add("fader-image","fader-image--preview"),i.style.opacity="0",i}async _initNodes(){let i=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&i.appendChild(this._previewImage);let e=document.createElement("div");i.appendChild(e);let t=this._keypoints.map(h=>h.src),{images:s,promise:o,cancel:n}=ue(t);s.forEach(h=>{let c=this._handleImageLoading(h.src);h.addEventListener("load",c),h.addEventListener("error",c)}),this._cancelLastImages=()=>{n(),this._cancelLastImages=void 0};let l=this._operation,a=this._filter;await o,this._isActive&&this._isSame(l,a)&&(this._container&&this._container.remove(),this._container=e,this._keypoints.forEach((h,c)=>{let d=s[c];d.classList.add("fader-image"),h.image=d,this._container.appendChild(d)}),this.appendChild(i),this._flush())}setTransformations(i){if(this._transformations=i,this._previewImage){let e=this._imageSrc(),t=this._handleImageLoading(e);this._previewImage.src=e,this._previewImage.addEventListener("load",t,{once:!0}),this._previewImage.addEventListener("error",t,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}preload({url:i,filter:e,operation:t,value:s}){this._cancelBatchPreload&&this._cancelBatchPreload();let n=Xt(t,s).map(a=>this._imageSrc({url:i,filter:e,operation:t,value:a})),{cancel:l}=ue(n);this._cancelBatchPreload=l}_setOriginalSrc(i){let e=this._previewImage||this._createPreviewImage();if(!this.contains(e)&&this.appendChild(e),this._previewImage=e,e.src===i){e.style.opacity="1",e.style.transform="scale(1)",this.className=y({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1});return}e.style.opacity="0";let t=this._handleImageLoading(i);e.addEventListener("error",t,{once:!0}),e.src=i,e.addEventListener("load",()=>{t(),e&&(e.style.opacity="1",e.style.transform="scale(1)",this.className=y({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}))},{once:!0}),e.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}activate({url:i,operation:e,value:t,filter:s,fromViewer:o}){if(this._isActive=!0,this._hidden=!1,this._url=i,this._operation=e||"initial",this._value=t,this._filter=s,this._fromViewer=o,typeof t!="number"&&!s){let l=this._imageSrc({operation:e,value:t});this._setOriginalSrc(l),this._container&&this._container.remove();return}this._keypoints=Xt(e,t).map(l=>this._constructKeypoint(e,l)),this._update(e,t),this._initNodes()}deactivate({hide:i=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),i&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=y({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:!0}),this.addEventListener("transitionend",()=>{this._container&&this._container.remove()},{once:!0})):this._container&&this._container.remove()}};var Xi=1,ke=class extends _{initCallback(){super.initCallback(),this.addEventListener("wheel",i=>{i.preventDefault();let{deltaY:e,deltaX:t}=i;Math.abs(t)>Xi?this.scrollLeft+=t:this.scrollLeft+=e})}};ke.template=" <slot></slot> ";function Gi(r){return`<lr-presence-toggle class="tab-toggle" set="visible: presence.tabToggle.${r}; styles: presence.tabToggleStyles;"><lr-btn-ui theme="boring" ref="tab-toggle-${r}" data-id="${r}" icon="${r}" tabindex="0" set="onclick: on.clickTab;" ></lr-btn-ui></lr-presence-toggle>`}function Ki(r){return`<lr-presence-toggle class="tab-content" set="visible: presence.tabContent.${r}; styles: presence.tabContentStyles"><lr-editor-scroller hidden-scrollbar><div class="controls-list_align"><div class="controls-list_inner" ref="controls-list-${r}"></div></div></lr-editor-scroller></lr-presence-toggle>`}var Ie=class extends _{constructor(){super();p(this,"_updateInfoTooltip",A(()=>{var n,l;let e=this.$["*editorTransformations"],t=this.$["*currentOperation"],s="",o=!1;if(this.$["*tabId"]===w.FILTERS)if(o=!0,this.$["*currentFilter"]&&((n=e==null?void 0:e.filter)==null?void 0:n.name)===this.$["*currentFilter"]){let a=((l=e==null?void 0:e.filter)==null?void 0:l.amount)||100;s=this.$["*currentFilter"]+" "+a}else s=this.l10n(R);else if(this.$["*tabId"]===w.TUNING&&t){o=!0;let a=(e==null?void 0:e[t])||L[t].zero;s=this.l10n(t)+" "+a}o&&(this.$["*operationTooltip"]=s),this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",o)},0));this.init$={...this.init$,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*currentFilter":R,"*currentOperation":null,showLoader:!1,filters:Ct,colorOperations:Et,cropOperations:Tt,"*operationTooltip":null,"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabToggles":!0,"presence.tabContent.crop":!1,"presence.tabContent.tuning":!1,"presence.tabContent.filters":!1,"presence.tabToggle.crop":!0,"presence.tabToggle.tuning":!0,"presence.tabToggle.filters":!0,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"presence.tabToggleStyles":{hidden:"tab-toggle--hidden",visible:"tab-toggle--visible"},"presence.tabTogglesStyles":{hidden:"tab-toggles--hidden",visible:"tab-toggles--visible"},"on.cancel":()=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":()=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":()=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":()=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":e=>{let t=e.currentTarget.getAttribute("data-id");t&&this._activateTab(t,{fromViewer:!1})}},this._debouncedShowLoader=A(this._showLoader.bind(this),500)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===w.TUNING&&this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",!1)}_createOperationControl(e){let t=new fe;return t.operation=e,t}_createFilterControl(e){let t=new re;return t.filter=e,t}_createToggleControl(e){let t=new he;return t.operation=e,t}_renderControlsList(e){let t=this.ref[`controls-list-${e}`],s=document.createDocumentFragment();e===w.CROP?this.$.cropOperations.forEach(o=>{let n=this._createToggleControl(o);s.appendChild(n)}):e===w.FILTERS?[R,...this.$.filters].forEach(o=>{let n=this._createFilterControl(o);s.appendChild(n)}):e===w.TUNING&&this.$.colorOperations.forEach(o=>{let n=this._createOperationControl(o);s.appendChild(n)}),[...s.children].forEach((o,n)=>{n===s.childNodes.length-1&&o.classList.add("controls-list_last-item")}),t.innerHTML="",t.appendChild(s)}_activateTab(e,{fromViewer:t}){this.$["*tabId"]=e,e===w.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:t})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:t}),this.$["*cropperEl"].deactivate());for(let s of T){let o=s===e,n=this.ref[`tab-toggle-${s}`];n.active=o,o?(this._renderControlsList(e),this._syncTabIndicator()):this._unmountTabControls(s),this.$[`presence.tabContent.${s}`]=o}}_unmountTabControls(e){let t=this.ref[`controls-list-${e}`];t&&(t.innerHTML="")}_syncTabIndicator(){let e=this.ref[`tab-toggle-${this.$["*tabId"]}`],t=this.ref["tabs-indicator"];t.style.transform=`translateX(${e.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let e=this.$["*imgContainerEl"].offsetWidth,t=this.proxyUrl(se(this.$["*originalUrl"],e,this.$["*editorTransformations"]));this._cancelPreload&&this._cancelPreload();let{cancel:s}=ue([t]);this._cancelPreload=()=>{s(),this._cancelPreload=void 0}}}_showLoader(e){this.$.showLoader=e}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",e=>{e&&setTimeout(()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})},0)}),this.sub("*editorTransformations",e=>{var s;let t=(s=e==null?void 0:e.filter)==null?void 0:s.name;this.$["*currentFilter"]!==t&&(this.$["*currentFilter"]=t)}),this.sub("*currentFilter",()=>{this._updateInfoTooltip()}),this.sub("*currentOperation",()=>{this._updateInfoTooltip()}),this.sub("*tabId",()=>{this._updateInfoTooltip()}),this.sub("*originalUrl",()=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()}),this.sub("*editorTransformations",e=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(e)}),this.sub("*loadingOperations",e=>{let t=!1;for(let[,s]of e.entries()){if(t)break;for(let[,o]of s.entries())if(o){t=!0;break}}this._debouncedShowLoader(t)}),this.sub("*showSlider",e=>{this.$["presence.subToolbar"]=e,this.$["presence.mainToolbar"]=!e}),this.sub("*tabList",e=>{this.$["presence.tabToggles"]=e.length>1;for(let t of T){this.$[`presence.tabToggle.${t}`]=e.includes(t);let s=this.ref[`tab-toggle-${t}`];s.style.gridColumn=e.indexOf(t)+1}e.includes(this.$["*tabId"])||this._activateTab(e[0],{fromViewer:!1})}),this._updateInfoTooltip()}};Ie.template=`<lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="info-tooltip_container"><div class="info-tooltip_wrapper"><div ref="tooltip-el" class="info-tooltip info-tooltip_hidden">{{*operationTooltip}}</div></div></div><div class="toolbar-container"><lr-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles"><div class="tab-content-row">${T.map(Ki).join("")}</div><div class="controls-row"><lr-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"></lr-btn-ui><lr-presence-toggle class="tab-toggles" set="visible: presence.tabToggles; styles: presence.tabTogglesStyles"><div ref="tabs-indicator" class="tab-toggles_indicator"></div> ${T.map(Gi).join("")} </lr-presence-toggle><lr-btn-ui theme="primary" icon="done" set="onclick: on.apply"></lr-btn-ui></div></lr-presence-toggle><lr-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles"><div class="slider"><lr-editor-slider ref="slider-el"></lr-editor-slider></div><div class="controls-row"><lr-btn-ui theme="boring" set="onclick: on.cancelSlider;" l10n="@text:cancel"></lr-btn-ui><lr-btn-ui theme="primary" set="onclick: on.applySlider;" l10n="@text:apply"></lr-btn-ui></div></lr-presence-toggle></div>`;var pe=class extends _{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.init$,text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",i=>{i?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return y("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",i=>{this._iconSingle=!this.$.text,this._iconHidden=!i,this.$.iconCss=this._iconCss()}),this.sub("theme",i=>{i!=="custom"&&(this.className=i)}),this.sub("text",i=>{this._iconSingle=!1}),this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(i){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}};pe.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"});pe.template=`<lr-icon set="className: iconCss; @name: icon; @hidden: !icon"></lr-icon><div class="text">{{text}}</div>`;var Pe=class extends _{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let i=this.ref["line-el"];i.style.transition="initial",i.style.opacity="0",i.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",i=>{typeof i=="boolean"&&(i?this._start():this._stop())})}_start(){this._active=!0;let{width:i}=this.getBoundingClientRect(),e=this.ref["line-el"];e.style.transition="transform 1s",e.style.opacity="1",e.style.transform=`translateX(${i}px)`,e.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}};Pe.template=`<div class="inner"><div class="line" ref="line-el"></div></div>`;var Le={transition:"transition",visible:"visible",hidden:"hidden"},Me=class extends _{constructor(){super(),this._visible=!1,this._visibleStyle=Le.visible,this._hiddenStyle=Le.hidden,this._externalTransitions=!1,this.defineAccessor("styles",i=>{i&&(this._externalTransitions=!0,this._visibleStyle=i.visible,this._hiddenStyle=i.hidden)}),this.defineAccessor("visible",i=>{typeof i=="boolean"&&(this._visible=i,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",$t(this,{[Le.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(Le.transition),this._handleVisible(),setTimeout(()=>this.removeAttribute("hidden"),0)}};Me.template=" <slot></slot> ";var Ne=class extends _{constructor(){super();p(this,"init$",{...this.init$,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e),this.$.onInput&&this.$.onInput(e)},"on.sliderChange":()=>{let e=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(e)}});this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",t=>{this.$.disabled=t}),this.defineAccessor("min",t=>{this.$.min=t}),this.defineAccessor("max",t=>{this.$.max=t}),this.defineAccessor("defaultValue",t=>{this.$.defaultValue=t,this.ref["input-el"].value=t,this._updateValue(t)}),this.defineAccessor("zero",t=>{this._zero=t}),this.defineAccessor("onInput",t=>{t&&(this.$.onInput=t)}),this.defineAccessor("onChange",t=>{t&&(this.$.onChange=t)}),this._updateSteps(),this._observer=new ResizeObserver(()=>{this._updateSteps();let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)}),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)},0),this.sub("disabled",t=>{let s=this.ref["input-el"];t?s.setAttribute("disabled","disabled"):s.removeAttribute("disabled")});let e=this.ref["input-el"];e.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),e.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}_updateValue(e){this._updateZeroDot(e);let{width:t}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(e-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this.ref["thumb-el"].style.transform=`translateX(${n}px)`})}_updateZeroDot(e){if(!this._zeroDotEl)return;e===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:t}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl.style.transform=`translateX(${n}px)`})}_updateSteps(){let t=this.ref["steps-el"],{width:s}=t.getBoundingClientRect(),o=Math.ceil(s/2),n=Math.ceil(o/15)-2;if(this._stepsCount===n)return;let l=document.createDocumentFragment(),a=document.createElement("div"),h=document.createElement("div");a.className="minor-step",h.className="border-step",l.appendChild(h);for(let d=0;d<n;d++)l.appendChild(a.cloneNode());l.appendChild(h.cloneNode());for(let d=0;d<n;d++)l.appendChild(a.cloneNode());l.appendChild(h.cloneNode());let c=document.createElement("div");c.className="zero-dot",l.appendChild(c),this._zeroDotEl=c,t.innerHTML="",t.appendChild(l),this._stepsCount=n}destroyCallback(){var e;(e=this._observer)==null||e.disconnect()}};Ne.template=`<div class="steps" ref="steps-el"></div><div ref="thumb-el" class="thumb"></div><input class="input" type="range" ref="input-el" tabindex="0" set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;" />`;var Gt=class extends G{initCallback(){super.initCallback(),this.__shadowReady=!0,this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async initEditor(){this.__shadowReady&&await super.initEditor()}};var me=class extends _{constructor(){super(),this.init$={...this.init$,name:"",href:"",title:""}}initCallback(){super.initCallback(),this.sub("name",i=>{if(!i)return;let e=`#uc-icon-${i}`;this.subConfigValue("iconHrefResolver",t=>{if(t){let s=t(i);e=s!=null?s:e}this.$.href=e})})}};me.template=`<svg ref="svg" xmlns="http://www.w3.org/2000/svg"><title>{{title}}</title><use set="@href: href;"></use></svg>`;me.bindAttributes({name:"name",title:"title"});function Wi(r){for(let i in r){let e=[...i].reduce((t,s)=>(s.toUpperCase()===s&&(s="-"+s.toLowerCase()),t+=s),"");e.startsWith("-")&&(e=e.replace("-","")),e.startsWith("lr-")||(e="lr-"+e),r[i].reg&&r[i].reg(e)}}var Re=r=>{var i;return(i=r.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g))==null?void 0:i.map(e=>e.toLowerCase()).join("-")};var x=r=>String(r),F=r=>{let i=Number(r);if(Number.isNaN(i))throw new Error(`Invalid number: "${r}"`);return i},E=r=>{if(typeof r=="undefined"||r===null)return!1;if(typeof r=="boolean")return r;if(r==="true"||r==="")return!0;if(r==="false")return!1;throw new Error(`Invalid boolean: "${r}"`)},qi=r=>{if(typeof r=="function")return r;throw new Error("Invalid function value. Must be a function.")},Yi=r=>r==="auto"?r:E(r),Zi=r=>{let i=x(r);if(i!=="user"&&i!=="environment"&&i!=="")throw new Error(`Invalid "cameraCapture" value: "${i}"`);return i},Qi=r=>{if(typeof r=="object"&&!Array.isArray(r)||typeof r=="function")return r;throw new Error("Invalid metadata value. Must be an object or function.")},Ji=r=>{if(typeof r=="object")return r;throw new Error("Invalid localeDefinitionOverride value. Must be an object.")},er={pubkey:x,multiple:E,multipleMin:F,multipleMax:F,confirmUpload:E,imgOnly:E,accept:x,externalSourcesPreferredTypes:x,store:Yi,cameraMirror:E,cameraCapture:Zi,sourceList:x,maxLocalFileSizeBytes:F,thumbSize:F,showEmptyList:E,useLocalImageEditor:E,useCloudImageEditor:E,cloudImageEditorTabs:x,removeCopyright:E,cropPreset:x,imageShrink:x,modalScrollLock:E,modalBackdropStrokes:E,sourceListWrap:E,remoteTabSessionKey:x,cdnCname:x,baseUrl:x,socialBaseUrl:x,secureSignature:x,secureExpire:x,secureDeliveryProxy:x,retryThrottledRequestMaxTimes:F,multipartMinFileSize:F,multipartChunkSize:F,maxConcurrentRequests:F,multipartMaxConcurrentRequests:F,multipartMaxAttempts:F,checkForUrlDuplicates:E,saveUrlForRecurrentUploads:E,groupOutput:E,userAgentIntegration:x,debug:E,localeName:x,metadata:Qi,localeDefinitionOverride:Ji,iconHrefResolver:qi},Kt=(r,i)=>{if(!(typeof i=="undefined"||i===null))try{return er[r](i)}catch(e){return console.error(`Invalid value for config key "${r}".`,e),O[r]}};var qe=[...new Set(["debug",...Object.keys(O)])],tr=["metadata","localeDefinitionOverride","iconHrefResolver"],ir=r=>tr.includes(r),oe=qe.filter(r=>!ir(r)),rr={...Object.fromEntries(oe.map(r=>[Re(r),r])),...Object.fromEntries(oe.map(r=>[r.toLowerCase(),r]))},sr={...Object.fromEntries(oe.map(r=>[Re(r),C(r)])),...Object.fromEntries(oe.map(r=>[r.toLowerCase(),C(r)]))},Wt=r=>"__"+r,_e=class extends _{constructor(){super();p(this,"requireCtxName",!0);this.init$={...this.init$,...Object.fromEntries(Object.entries(O).map(([e,t])=>[C(e),t]))}}_flushValueToAttribute(e,t){if(oe.includes(e)){let s=[...new Set([Re(e),e.toLowerCase()])];for(let o of s)typeof t=="undefined"||t===null?this.removeAttribute(o):this.getAttribute(o)!==t.toString()&&this.setAttribute(o,t.toString())}}_flushValueToState(e,t){this.$[C(e)]!==t&&(typeof t=="undefined"||t===null?this.$[C(e)]=O[e]:this.$[C(e)]=t)}_setValue(e,t){let s=this,o=Kt(e,t),n=Wt(e);s[n]!==o&&(this._assertSameValueDifferentReference(e,s[n],o),s[n]=o,this._flushValueToAttribute(e,o),this._flushValueToState(e,o),this.debugPrint(`[lr-config] "${e}"`,o))}_getValue(e){let t=this,s=Wt(e);return t[s]}_assertSameValueDifferentReference(e,t,s){this.cfg.debug&&s!==t&&typeof s=="object"&&typeof t=="object"&&JSON.stringify(s)===JSON.stringify(t)&&(console.warn(`[lr-config] Option "${e}" value is the same as the previous one but the reference is different`),console.warn("[lr-config] You should avoid changing the reference of the object to prevent unnecessary calculations"),console.warn(`[lr-config] "${e}" previous value:`,t),console.warn(`[lr-config] "${e}" new value:`,s))}initCallback(){var t;super.initCallback();let e=this;for(let s of oe)this.sub(C(s),o=>{this._setValue(s,o)},!1);for(let s of qe){let o=(t=e[s])!=null?t:this.$[C(s)];o!==O[s]&&this._setValue(s,o),Object.defineProperty(this,s,{set:n=>{this._setValue(s,n)},get:()=>this._getValue(s)})}}attributeChangedCallback(e,t,s){if(t===s)return;let o=this,n=rr[e];o[n]=s}};_e.bindAttributes(sr);for(let r of qe)_e.prototype[r]=void 0;var or=_e;export{Gt as CloudImageEditor,G as CloudImageEditorBlock,or as Config,Se as CropFrame,he as EditorCropButtonControl,re as EditorFilterControl,Oe as EditorImageCropper,We as EditorImageFader,fe as EditorOperationControl,ke as EditorScroller,$e as EditorSlider,Ie as EditorToolbar,me as Icon,Pe as LineLoaderUi,pe as LrBtnUi,Me as PresenceToggle,Ne as SliderUi,Wi as registerBlocks};